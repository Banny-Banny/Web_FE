# 기능 명세서: 프로필 수정

## 개요

마이페이지 프로필 섹션에서 사용자가 자신의 **프로필 사진**과 **닉네임**만 수정할 수 있는 기능입니다. 프로필 이미지 오른쪽 하단의 카메라 버튼을 누르면 프로필 수정 모달이 열리고, 모달 내에서 사진 변경과 닉네임 수정 후 저장할 수 있습니다.

### 배경

현재 마이페이지의 프로필 섹션은 로그인한 사용자의 프로필 정보(닉네임, 이메일, 프로필 이미지)를 조회하여 표시만 하고 있습니다. 서버 API는 닉네임·이메일 수정과 프로필 이미지 업로드를 제공하나, 사용자 화면에서는 **사진과 닉네임만** 변경할 수 있도록 제한합니다.

### 목적

- 사용자가 마이페이지에서 프로필 사진과 닉네임을 직접 수정할 수 있도록 함
- 카메라 버튼 클릭 시 프로필 수정 모달을 열어, 한 화면에서 사진 변경과 닉네임 수정을 수행할 수 있게 함
- 모달 내 "사진 변경" 버튼을 통해 새 프로필 이미지를 업로드할 수 있게 함
- 수정 내용 저장 시 서버에 반영되고, 화면에 즉시 반영되도록 함

## 기능 요구사항

### FR-1: 프로필 수정 모달 열기

**설명**: 사용자가 프로필 영역의 카메라 버튼(cameraButtonWrapper)을 클릭하면 프로필 수정 모달이 표시됩니다.

**수락 기준**:
- 프로필 이미지 오른쪽 하단의 카메라 버튼을 클릭하면 프로필 수정 모달이 열림
- 모달은 화면 중앙에 표시되며, 배경은 어둡게 처리됨
- 모달 상단에 "프로필 수정" 제목이 표시됨
- 모달 외부(배경) 클릭 또는 닫기 동작으로 모달을 닫을 수 있음
- 로딩 중이거나 에러 상태, 프로필 데이터가 없을 때는 카메라 버튼 비활성화 등으로 모달을 열 수 없음

### FR-2: 프로필 수정 모달 UI (디자인 기준)

**설명**: 프로필 수정 모달은 연동된 Figma 디자인(프로필 수정 모달)을 기준으로 구성됩니다.

**수락 기준**:
- 모달 상단: "프로필 수정" 제목
- **프로필 사진 변경 영역**: 현재 프로필 사진(또는 기본 이미지)이 원형으로 표시되고, 그 아래 "사진 변경" 버튼이 있음
- **닉네임 변경 영역**: "닉네임" 레이블과 현재 닉네임이 채워진 입력 필드
- **하단 버튼**: "취소" 버튼(보조 스타일), "저장" 버튼(주요 스타일)이 가로로 배치됨
- 이메일 등 닉네임·사진 외 필드는 모달에 노출하지 않음

### FR-3: 사진 변경(프로필 이미지 업로드)

**설명**: 모달에서 "사진 변경" 버튼을 누르면 사용자가 프로필 이미지를 선택·업로드할 수 있습니다.

**수락 기준**:
- "사진 변경" 버튼 클릭 시 사용자가 디바이스에서 이미지 파일을 선택할 수 있는 흐름이 제공됨
- 허용 형식(예: jpeg, png, webp) 및 최대 크기(예: 5MB) 제한에 맞는 파일만 업로드 가능함
- 업로드 진행 중에는 로딩 또는 진행 상태를 사용자에게 표시함
- 업로드 성공 시 모달 내 프로필 미리보기와, 필요 시 프로필 섹션의 프로필 이미지가 새 이미지로 갱신됨
- 형식/크기 위반 또는 업로드 실패 시 사용자에게 명확한 오류 메시지를 표시함
- 인증되지 않은 사용자 요청 등 401 응답 시 적절한 안내를 표시함

### FR-4: 닉네임 수정

**설명**: 모달의 닉네임 입력 필드에서 닉네임을 수정하고, "저장" 시 서버에 반영됩니다.

**수락 기준**:
- 모달이 열릴 때 현재 프로필의 닉네임이 입력 필드에 표시됨
- 사용자가 닉네임을 수정할 수 있음
- 닉네임에 대한 유효성 검사(길이, 허용 문자 등)가 정의된 경우 이를 만족해야 저장 가능함
- "저장" 클릭 시 수정된 닉네임만 서버에 전송함(이메일은 요청에 포함하지 않음)
- 닉네임 중복(409) 등 실패 시 사용자에게 오류 메시지를 표시함
- 저장 성공 시 모달이 닫히고, 프로필 섹션의 닉네임이 즉시 갱신됨

### FR-5: 저장 및 취소

**설명**: 사용자가 "저장"으로 변경 사항을 반영하거나 "취소"로 모달을 닫을 수 있습니다.

**수락 기준**:
- "저장" 클릭 시 프로필 이미지 변경이 있으면 해당 업로드가 반영된 후, 닉네임 변경이 있으면 닉네임 수정 요청이 수행됨(순서·조합은 백엔드 규격에 따름)
- 저장 진행 중에는 중복 제출 방지 및 로딩 표시가 이루어짐
- "취소" 클릭 시 확인 없이 모달이 닫히며, 미저장 변경 사항은 버려짐
- 모달 닫기(배경 클릭, ESC 등) 시에도 "취소"와 동일하게 동작할 수 있음

## 사용자 시나리오

### 시나리오 1: 프로필 수정 모달 열기

1. 사용자가 마이페이지 프로필 섹션에서 프로필 이미지 오른쪽 하단의 카메라 버튼을 클릭함
2. 프로필 수정 모달이 화면 중앙에 표시됨
3. 모달에 현재 프로필 사진(또는 기본 이미지)과 닉네임이 표시됨
4. 사용자는 사진 변경 또는 닉네임 수정을 진행할 수 있음

### 시나리오 2: 프로필 사진만 변경

1. 사용자가 프로필 수정 모달을 연 후 "사진 변경" 버튼을 클릭함
2. 파일 선택 대화상자(또는 동일 목적의 UI)가 열림
3. 사용자가 jpeg/png/webp 등 허용된 형식의 이미지를 선택함
4. 이미지가 업로드되고 모달 내 미리보기가 새 이미지로 갱신됨
5. 사용자가 "저장"을 클릭함
6. 변경 사항이 서버에 반영되고 모달이 닫힌 후, 프로필 섹션의 프로필 이미지가 새로고침됨

### 시나리오 3: 닉네임만 변경

1. 사용자가 프로필 수정 모달을 연 후 닉네임 입력 필드에서 텍스트를 수정함
2. "저장"을 클릭함
3. 수정된 닉네임이 서버에 반영됨
4. 모달이 닫히고 프로필 섹션의 닉네임이 갱신됨

### 시나리오 4: 사진과 닉네임 모두 변경 후 저장

1. 사용자가 모달에서 "사진 변경"으로 이미지를 업로드하고, 닉네임도 수정함
2. "저장"을 클릭함
3. 사진 업로드와 닉네임 수정이 모두 서버에 반영됨
4. 모달이 닫히고 프로필 섹션에 새 프로필 이미지와 닉네임이 표시됨

### 시나리오 5: 취소로 모달 닫기

1. 사용자가 모달에서 사진 또는 닉네임을 변경함
2. "취소"를 클릭함(또는 배경 클릭/ESC로 닫기)
3. 모달이 닫히고 변경 사항은 저장되지 않음
4. 프로필 섹션은 기존 데이터 그대로 유지됨

### 시나리오 6: 사진 업로드 실패(형식/크기 오류)

1. 사용자가 "사진 변경" 후 허용되지 않은 형식이거나 최대 크기를 초과한 파일을 선택함
2. 시스템이 검증에 실패함
3. "파일 형식이 올바르지 않습니다" 또는 "파일 크기는 5MB 이하여야 합니다" 등 명확한 메시지가 표시됨
4. 사용자는 다시 적절한 파일을 선택할 수 있음

### 시나리오 7: 닉네임 중복(409)

1. 사용자가 이미 다른 사용자가 사용 중인 닉네임으로 수정 후 "저장"을 클릭함
2. 서버가 중복으로 인한 오류를 반환함
3. "이미 사용 중인 닉네임입니다" 등 안내 메시지가 표시됨
4. 모달은 유지되고 사용자가 닉네임을 다시 수정할 수 있음

## 성공 기준

### SC-1: 모달 진입

- 카메라 버튼 클릭 후 1초 이내에 프로필 수정 모달이 표시됨
- 모달이 Figma 디자인과 일치하는 구조와 정보(제목, 사진 영역, 닉네임 필드, 취소/저장 버튼)를 가짐

### SC-2: 프로필 이미지 업로드

- 허용 형식·크기 내 이미지 업로드 시 5초 이내에 완료되고 미리보기에 반영됨
- 업로드 실패 시 100% 경우에 사용자에게 오류 사유가 안내됨

### SC-3: 닉네임 저장

- 유효한 닉네임 저장 요청이 3초 이내에 완료됨
- 저장 성공 시 프로필 섹션에 변경된 닉네임이 즉시 반영됨

### SC-4: 사용자 제어

- 사용자가 "취소" 또는 닫기로 모달을 닫을 수 있으며, 이때만 미저장 변경이 버려짐
- 저장 중에는 재전송 방지 및 로딩 표시로 의도가 명확히 전달됨

## 핵심 엔티티

### 프로필(사용자)

- **id**: 사용자 식별자
- **nickname**: 닉네임
- **profileImg**: 프로필 이미지 URL (없을 수 있음)
- (기타 MeResponse 필드는 조회용으로만 사용, 수정 화면에는 닉네임·사진만 노출)

### 프로필 수정 모달 상태

- 모달 열림/닫힘
- 현재 표시 중인 프로필 이미지(원본 또는 업로드 직후 미리보기)
- 닉네임 입력값
- 업로드/저장 진행 여부 및 오류 메시지

### 프로필 이미지 업로드

- 허용 형식: jpeg, png, webp
- 최대 파일 크기: 5MB
- 업로드 성공 시 서버가 반환하는 프로필 이미지 URL이 프로필에 반영됨

### 닉네임 수정

- 서버에 닉네임만 전송(이메일은 전송하지 않음)
- 중복 시 409 응답으로 처리하고 사용자에게 안내

## 비기능 요구사항

### NFR-1: 반응 및 피드백

- 모달 열기/닫기가 즉시 반응함
- 업로드 및 저장 중 로딩 상태가 표시됨
- 오류 시 메시지가 5초 이상 노출되거나, 사용자 동작으로 닫을 수 있음

### NFR-2: 접근성

- 카메라 버튼에 "프로필 사진 변경" 등 적절한 라벨이 있음
- 모달 포커스 관리 및 ESC로 닫기가 가능함(선택 구현)
- 키보드만으로 닉네임 입력 및 저장/취소 선택이 가능함

### NFR-3: 보안

- 프로필 수정·이미지 업로드는 인증된 사용자만 요청할 수 있음
- 401 시 로그인 유도 등 적절한 안내가 표시됨

## 제약사항

- 서버 API가 닉네임·이메일 수정과 프로필 이미지 업로드를 별도 엔드포인트로 제공하므로, 클라이언트는 "닉네임만" 수정 요청하고, 프로필 이미지는 전용 업로드 API를 사용함
- 사용자 화면에서는 **프로필 사진과 닉네임만** 수정 가능하며, 이메일 수정 UI는 제공하지 않음
- 프로필 수정 모달의 레이아웃·요소 구성은 제공된 Figma 디자인(노드 161-24140)을 기준으로 함

## 가정사항

- 사용자는 로그인된 상태이며, `/api/me`로 조회한 프로필 데이터가 존재함
- 프로필 수정 API(POST /api/me/update)는 닉네임(및 선택적으로 이메일) 수정을 지원함
- 프로필 이미지 업로드 API(POST /api/me/profile-image)는 multipart/form-data로 이미지를 받아 저장하고, 프로필에 반영된 URL을 반환함
- 이미지 파일 검증(형식, 크기)은 클라이언트와 서버 모두에서 수행될 수 있음

## 엣지 케이스

### EC-1: 프로필 데이터 없음

- 프로필 조회 실패 또는 데이터 없음 시 카메라 버튼을 비활성화하여 모달을 열 수 없게 함

### EC-2: 저장 중 네트워크 오류

- 저장 요청 실패 시 "네트워크 연결을 확인해주세요" 등 메시지를 표시하고, 모달은 유지하여 재시도할 수 있게 함

### EC-3: 이미지 업로드 후 저장하지 않고 취소

- "사진 변경"으로 업로드만 하고 "취소"를 누르면, 서버에 반영된 이미지 여부는 백엔드 정책에 따름. 클라이언트는 모달을 닫고 프로필 섹션은 기존 데이터로 유지·갱신함

### EC-4: 닉네임 빈 값 또는 최소/최대 길이

- 닉네임 필수일 경우 빈 값으로 저장할 수 없고, 길이 제한이 있으면 그에 맞는 검증 메시지를 표시함
