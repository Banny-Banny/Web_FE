# 이스터에그 슬롯 관리 기능 명세서

## 1. 개요

### 1.1 배경
사용자는 이스터에그를 작성할 수 있는 슬롯 개수에 제한이 있습니다. 사용자가 자신의 슬롯 상태를 실시간으로 확인하고, 필요시 모든 이스터에그를 초기화하여 슬롯을 다시 사용할 수 있는 기능이 필요합니다.

### 1.2 목적
- 사용자가 현재 사용 가능한 이스터에그 슬롯 개수를 명확히 인지
- 슬롯이 부족할 때 기존 이스터에그를 초기화하여 다시 작성 가능
- 슬롯 상태 변경 시 즉각적인 UI 반영으로 혼란 방지

### 1.3 범위
이 명세서는 다음을 포함합니다:
- 이스터에그 슬롯 조회 기능
- 이스터에그 슬롯 초기화 기능
- 슬롯 상태의 실시간 반영

이 명세서는 다음을 포함하지 않습니다:
- 이스터에그 작성 기능 (별도 명세)
- 슬롯 개수 변경 로직 (서버 정책)

---

## 2. 기능 요구사항

### 2.1 슬롯 조회 기능

#### FR-1: 슬롯 상태 표시
- 사용자는 화면에서 전체 슬롯 개수, 사용 중인 슬롯 개수, 남은 슬롯 개수를 확인할 수 있어야 한다
- 슬롯 상태는 시각적으로 구분되어야 한다 (채워진 알 vs 빈 알)

#### FR-2: 실시간 슬롯 업데이트
- 이스터에그 작성 완료 시 남은 슬롯 개수가 즉시 감소해야 한다
- 슬롯 초기화 시 남은 슬롯 개수가 즉시 기본값으로 복구되어야 한다
- 화면 새로고침 없이 슬롯 상태가 자동으로 갱신되어야 한다

#### FR-3: 슬롯 정보 접근성
- 사용자는 홈 화면의 egg-slot 컴포넌트에서 슬롯 상태를 확인할 수 있어야 한다
- 사용자는 egg-slot을 클릭하여 상세 모달에서 슬롯 상태를 확인할 수 있어야 한다

### 2.2 슬롯 초기화 기능

#### FR-4: 초기화 버튼 제공
- 슬롯 상세 모달 내에 초기화 버튼이 표시되어야 한다
- 버튼의 용도가 명확하게 전달되어야 한다

#### FR-5: 초기화 경고 안내
- 초기화 버튼 클릭 시 사용자에게 경고 메시지가 표시되어야 한다
- 경고 메시지는 다음을 포함해야 한다:
  - 모든 이스터에그가 삭제됨
  - 관련된 모든 데이터(엔트리, 슬롯, 조회 로그)가 함께 삭제됨
  - 슬롯이 기본값(3개)으로 초기화됨
  - 이 작업은 되돌릴 수 없음

#### FR-6: 초기화 확인 절차
- 사용자는 경고 메시지를 확인한 후 초기화를 진행하거나 취소할 수 있어야 한다
- 취소 시 아무런 변경 없이 모달로 돌아가야 한다
- 확인 시 초기화가 즉시 실행되어야 한다

#### FR-7: 초기화 후 상태 반영
- 초기화 완료 즉시 슬롯 개수가 3개로 표시되어야 한다
- 초기화 완료 후 사용자는 즉시 새로운 이스터에그를 작성할 수 있어야 한다

### 2.3 오류 처리

#### FR-8: 인증 오류 처리
- 인증되지 않은 사용자가 슬롯 조회 시도 시 로그인 화면으로 이동해야 한다
- 인증되지 않은 사용자가 슬롯 초기화 시도 시 로그인 화면으로 이동해야 한다

#### FR-9: 네트워크 오류 처리
- 슬롯 조회 실패 시 사용자에게 오류 메시지가 표시되어야 한다
- 초기화 실패 시 사용자에게 오류 메시지가 표시되어야 한다
- 오류 발생 시 재시도 옵션이 제공되어야 한다

---

## 3. 사용자 시나리오

### 3.1 슬롯 상태 확인

**시나리오**: 사용자가 남은 슬롯을 확인한다

1. 사용자가 홈 화면에 접속한다
2. 화면 상단에 egg-slot 컴포넌트가 표시된다
3. 사용자는 3개의 알 아이콘을 본다
   - 채워진 알: 사용 가능한 슬롯
   - 빈 알: 사용된 슬롯
4. 사용자가 egg-slot을 클릭한다
5. 슬롯 상세 모달이 열린다
6. 모달에서 전체 슬롯 개수, 사용 중인 개수, 남은 개수를 숫자로 확인한다

### 3.2 이스터에그 작성 후 슬롯 감소

**시나리오**: 사용자가 이스터에그를 작성하면 슬롯이 감소한다

1. 사용자가 남은 슬롯이 3개인 상태에서 이스터에그 작성을 완료한다
2. 작성 완료 즉시 egg-slot 컴포넌트의 알 아이콘이 변경된다
   - 채워진 알 3개 → 채워진 알 2개, 빈 알 1개
3. 사용자가 egg-slot을 클릭하여 모달을 연다
4. 모달에 "남은 슬롯: 2개"로 표시된다

### 3.3 슬롯 초기화

**시나리오**: 사용자가 모든 슬롯을 사용하여 초기화한다

1. 사용자가 3개의 이스터에그를 모두 작성한 상태다 (남은 슬롯 0개)
2. 사용자가 egg-slot을 클릭하여 모달을 연다
3. 모달에 "슬롯 초기화" 버튼이 표시된다
4. 사용자가 "슬롯 초기화" 버튼을 클릭한다
5. 경고 메시지가 표시된다:
   - "모든 이스터에그와 관련 데이터가 영구적으로 삭제됩니다."
   - "슬롯은 3개로 초기화됩니다."
   - "이 작업은 되돌릴 수 없습니다."
6. 사용자가 "확인" 버튼을 클릭한다
7. 초기화가 실행된다
8. 모달이 자동으로 닫힌다
9. egg-slot 컴포넌트에 채워진 알 3개가 표시된다
10. 사용자가 즉시 새로운 이스터에그를 작성할 수 있다

### 3.4 초기화 취소

**시나리오**: 사용자가 초기화를 시작했다가 취소한다

1. 사용자가 "슬롯 초기화" 버튼을 클릭한다
2. 경고 메시지가 표시된다
3. 사용자가 내용을 읽고 "취소" 버튼을 클릭한다
4. 경고 메시지가 닫힌다
5. 슬롯 상세 모달로 돌아간다
6. 아무런 변경 없이 기존 슬롯 상태가 유지된다

---

## 4. 성공 기준

### 4.1 기능 완성도
- [ ] 사용자가 홈 화면과 모달에서 슬롯 상태를 확인할 수 있다
- [ ] 이스터에그 작성 완료 후 2초 이내에 슬롯 개수가 반영된다
- [ ] 슬롯 초기화 완료 후 2초 이내에 슬롯 개수가 3개로 복구된다
- [ ] 초기화 전 경고 메시지가 표시된다

### 4.2 사용자 경험
- [ ] 슬롯 상태가 시각적으로 명확하게 구분된다
- [ ] 경고 메시지의 내용이 명확하고 이해하기 쉽다
- [ ] 초기화 확인/취소 버튼이 명확하게 구분된다
- [ ] 오류 발생 시 사용자가 상황을 이해하고 대응할 수 있다

### 4.3 신뢰성
- [ ] 네트워크 오류 시 적절한 오류 메시지가 표시된다
- [ ] 인증 오류 시 로그인 화면으로 이동한다
- [ ] 초기화 작업이 실패하면 슬롯 상태가 변경되지 않는다

---

## 5. 핵심 엔티티

### 5.1 슬롯 정보 (Slot Information)

**속성**:
- 전체 슬롯 개수 (Total Slots)
  - 타입: 숫자
  - 설명: 사용자가 보유한 전체 슬롯 개수
  
- 사용 중인 슬롯 개수 (Used Slots)
  - 타입: 숫자
  - 설명: 현재 이스터에그가 작성되어 사용 중인 슬롯 개수
  
- 남은 슬롯 개수 (Remaining Slots)
  - 타입: 숫자
  - 설명: 새로운 이스터에그를 작성할 수 있는 남은 슬롯 개수
  - 계산: 전체 슬롯 개수 - 사용 중인 슬롯 개수

### 5.2 초기화 결과 (Reset Result)

**속성**:
- 초기화된 슬롯 개수 (Egg Slots)
  - 타입: 숫자
  - 설명: 초기화 후 복구된 슬롯 개수
  - 기본값: 3

---

## 6. 비기능 요구사항

### 6.1 성능
- 슬롯 조회 응답 시간: 1초 이내
- 초기화 작업 완료 시간: 3초 이내
- UI 업데이트 반영 시간: 2초 이내

### 6.2 보안
- 슬롯 조회 및 초기화는 인증된 사용자만 수행 가능
- 다른 사용자의 슬롯 정보에 접근 불가

### 6.3 접근성
- 슬롯 상태를 색상만이 아닌 아이콘 형태로도 구분
- 초기화 버튼의 위험성을 시각적으로 표현
- 경고 메시지 내용이 명확하고 구체적

---

## 7. 제약사항

### 7.1 비즈니스 제약
- 슬롯 기본값은 3개로 고정
- 초기화 시 모든 이스터에그 데이터가 영구 삭제
- 초기화 작업은 되돌릴 수 없음

### 7.2 기술 제약
- 슬롯 개수는 서버에서 관리
- 초기화는 서버에서 일괄 처리

---

## 8. 가정사항

- 사용자는 로그인 상태로 이 기능을 사용한다
- 슬롯 상태는 서버에서 관리되며 항상 최신 상태를 유지한다
- 초기화 작업은 트랜잭션으로 처리되어 부분 실패가 발생하지 않는다
- 네트워크 연결이 불안정할 수 있으므로 적절한 오류 처리가 필요하다

---

## 9. 엣지 케이스

### 9.1 동시 작업 충돌
- 사용자가 슬롯 조회 중 다른 기기에서 이스터에그를 작성한 경우
  - 화면 재진입 시 최신 슬롯 상태로 갱신

### 9.2 초기화 중 네트워크 끊김
- 초기화 요청 후 응답을 받기 전 네트워크가 끊긴 경우
  - 오류 메시지 표시
  - 재시도 옵션 제공
  - 슬롯 상태는 변경하지 않음

### 9.3 슬롯 개수 불일치
- 서버에서 반환된 슬롯 개수가 예상과 다른 경우
  - 서버의 값을 신뢰하여 UI에 반영
  - 음수 값인 경우 0으로 처리
  - 기본값(3)을 초과하는 경우 그대로 표시

---

## 10. 참고사항

### 10.1 관련 명세서
- 004-easter-egg-bottom-sheet: 이스터에그 작성 기능
- 005-easter-egg-form-submit: 이스터에그 제출 기능

### 10.2 영향받는 컴포넌트
- `egg-slot`: 슬롯 상태 표시 컴포넌트
- 슬롯 상세 모달 (신규 생성 예정): 슬롯 정보 및 초기화 버튼 포함

### 10.3 서버 API 엔드포인트
- `GET /api/capsules/slots`: 슬롯 조회
- `POST /api/capsules/slots/reset`: 슬롯 초기화
