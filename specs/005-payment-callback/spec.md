# 결제 승인 및 콜백 처리 명세서

**Feature Branch**: `feat/payment-callback`  
**Created**: 2026-01-27  
**Status**: Draft  
**Input**: User description: "토스페이먼츠 결제 승인 및 콜백 처리 기능을 구현합니다."

## 📋 개요

### 프로젝트 목표
사용자가 토스페이먼츠를 통해 결제를 완료한 후, 결제 결과를 확인하고 성공 시 타임캡슐 대기실로 이동하거나 실패 시 적절한 안내를 받을 수 있도록 합니다.

### 비즈니스 가치
- **결제 완료 경험 개선**: 결제 완료 후 즉시 다음 단계로 진행할 수 있어 사용자 이탈 방지
- **신뢰성 확보**: 결제 결과를 명확하게 확인하고 처리하여 사용자 신뢰도 향상
- **사용자 만족도 향상**: 결제 실패 시 명확한 안내와 재시도 옵션 제공으로 사용자 만족도 향상
- **비즈니스 연속성**: 결제 완료 후 자동으로 타임캡슐 생성 프로세스가 이어져 서비스 이용 연속성 확보

### 범위
- **포함**: 
  - 토스페이먼츠 결제 성공 콜백 처리 (success URL)
  - 토스페이먼츠 결제 실패 콜백 처리 (fail URL)
  - 결제 승인 처리 및 결과 확인
  - 결제 성공 시 타임캡슐 대기실 생성 및 이동
  - 결제 실패 시 에러 메시지 표시 및 재시도 안내
- **제외**: 
  - 결제 위젯 초기화 및 결제 시작 (결제 페이지에서 처리됨)
  - 주문 생성 (이미 결제 페이지 이전 단계에서 완료됨)
  - 환불 및 취소 처리 (별도 기능)
  - 결제 내역 조회 (별도 기능)

---

## 🎯 사용자 시나리오

### US1: 사용자가 결제를 완료하고 성공 결과를 확인 (Priority: P1)

**시나리오**: 사용자가 토스페이먼츠를 통해 결제를 완료한 후 성공 콜백 페이지로 이동할 때

**사용자 행동**:
1. 사용자가 결제 페이지에서 토스페이먼츠를 통해 결제를 완료
2. 사용자가 토스페이먼츠에서 결제 성공 후 성공 콜백 페이지로 리다이렉트됨
3. 시스템이 결제 승인을 처리하고 결과를 확인
4. 시스템이 타임캡슐 대기실을 생성
5. 사용자가 대기실 페이지로 자동 이동하여 다음 단계를 진행

**기대 결과**:
- 사용자가 결제 완료를 명확하게 확인할 수 있음
- 결제 승인 처리가 자동으로 완료됨
- 타임캡슐 대기실이 자동으로 생성됨
- 사용자가 대기실 페이지로 자연스럽게 이동함
- 결제 완료 후 추가 액션이 필요 없음

**성공 기준**:
- 결제 성공 콜백 페이지 로드 후 결제 승인 처리 완료 시간이 3초 이하
- 결제 승인 성공률이 98% 이상
- 타임캡슐 대기실 생성 성공률이 95% 이상
- 결제 성공 후 대기실 페이지 이동 성공률이 100%
- 사용자가 결제 완료를 인지하는 데 걸리는 시간이 5초 이하

**Acceptance Scenarios**:
1. **Given** 사용자가 토스페이먼츠를 통해 결제를 완료했을 때, **When** 성공 콜백 페이지로 이동하면, **Then** 결제 승인이 자동으로 처리됨
2. **Given** 결제 승인이 성공적으로 완료되었을 때, **When** 타임캡슐 대기실이 생성되면, **Then** 사용자가 대기실 페이지로 자동 이동함
3. **Given** 사용자가 결제 성공 콜백 페이지에 접근했을 때, **When** 페이지가 로드되면, **Then** 결제 완료 상태가 명확하게 표시됨

---

### US2: 사용자가 결제를 완료했지만 실패 결과를 받음 (Priority: P1)

**시나리오**: 사용자가 토스페이먼츠를 통해 결제를 시도했지만 실패하여 실패 콜백 페이지로 이동할 때

**사용자 행동**:
1. 사용자가 결제 페이지에서 토스페이먼츠를 통해 결제를 시도
2. 결제가 실패하여 사용자가 실패 콜백 페이지로 리다이렉트됨
3. 사용자가 실패 원인을 확인
4. 사용자가 실패 원인을 이해하고 재시도 또는 다른 조치를 취함

**기대 결과**:
- 사용자가 결제 실패를 명확하게 인지할 수 있음
- 결제 실패 원인이 이해하기 쉬운 언어로 표시됨
- 사용자가 재시도할 수 있는 옵션이 제공됨
- 사용자가 이전 페이지로 돌아갈 수 있는 방법이 제공됨
- 결제 실패로 인한 혼란이 최소화됨

**성공 기준**:
- 결제 실패 콜백 페이지 로드 후 실패 원인 표시 시간이 2초 이하
- 사용자가 결제 실패 원인을 파악하는 데 걸리는 시간이 1분 이하
- 결제 실패 후 사용자가 재시도하는 비율이 60% 이상
- 결제 실패 메시지 이해도가 90% 이상

**Acceptance Scenarios**:
1. **Given** 사용자가 토스페이먼츠를 통해 결제를 시도했지만 실패했을 때, **When** 실패 콜백 페이지로 이동하면, **Then** 실패 원인이 명확하게 표시됨
2. **Given** 사용자가 결제 실패 원인을 확인했을 때, **When** 재시도 옵션을 선택하면, **Then** 결제 페이지로 돌아가 다시 시도할 수 있음
3. **Given** 사용자가 결제 실패 후 다른 조치를 취하고 싶을 때, **When** 이전 페이지로 돌아가기를 선택하면, **Then** 적절한 페이지로 이동함

---

### US3: 사용자가 결제 승인 처리 중 오류를 경험하는 경우 (Priority: P2)

**시나리오**: 사용자가 결제를 완료했지만 결제 승인 처리 과정에서 오류가 발생할 때

**사용자 행동**:
1. 사용자가 토스페이먼츠를 통해 결제를 완료하고 성공 콜백 페이지로 이동
2. 시스템이 결제 승인을 처리하는 중 오류 발생 (네트워크 오류, 서버 오류 등)
3. 사용자가 오류 상황을 확인
4. 사용자가 적절한 조치를 취함 (재시도, 고객 지원 문의 등)

**기대 결과**:
- 오류 발생 시 명확하고 이해하기 쉬운 오류 메시지가 표시됨
- 사용자가 오류 상황을 쉽게 파악할 수 있음
- 사용자가 적절한 조치를 취할 수 있는 안내가 제공됨
- 결제 상태가 적절하게 관리됨
- 사용자가 결제 완료 여부를 확인할 수 있는 방법이 제공됨

**성공 기준**:
- 오류 메시지 표시 시간이 1초 이하
- 사용자가 오류 상황을 파악하는 데 걸리는 시간이 1분 이하
- 오류 발생 후 사용자가 적절한 조치를 취하는 비율이 70% 이상
- 결제 상태 관리 정확도가 100%

**Acceptance Scenarios**:
1. **Given** 사용자가 결제를 완료했지만 결제 승인 처리 중 네트워크 오류가 발생했을 때, **When** 오류가 감지되면, **Then** 명확한 오류 메시지가 표시되고 재시도 옵션이 제공됨
2. **Given** 사용자가 결제 승인 처리 중 오류를 경험했을 때, **When** 결제 상태를 확인하고 싶으면, **Then** 주문 상태 조회 기능을 통해 결제 완료 여부를 확인할 수 있음
3. **Given** 사용자가 결제 승인 처리 오류를 해결할 수 없을 때, **When** 고객 지원이 필요하면, **Then** 고객 지원 연락처 또는 안내가 제공됨

---

## 📋 기능 요구사항

### FR-001: 결제 성공 콜백 처리
**설명**: 사용자가 토스페이먼츠를 통해 결제를 완료한 후 성공 콜백을 처리합니다.

**요구사항**:
- 토스페이먼츠에서 전달된 결제 정보를 받아야 함
- 결제 승인을 처리해야 함
- 결제 승인 결과를 확인해야 함
- 결제 승인 성공 시 타임캡슐 대기실을 생성해야 함
- 결제 승인 성공 시 사용자를 대기실 페이지로 이동시켜야 함
- 결제 승인 처리 중 로딩 상태를 표시해야 함
- 결제 승인 실패 시 적절한 오류 처리를 해야 함

**검증 기준**:
- 토스페이먼츠에서 전달된 결제 정보가 정상적으로 수신됨
- 결제 승인이 정상적으로 처리됨
- 결제 승인 성공 시 타임캡슐 대기실이 생성됨
- 결제 승인 성공 시 사용자가 대기실 페이지로 이동함
- 결제 승인 처리 중 로딩 상태가 표시됨
- 결제 승인 실패 시 적절한 오류 메시지가 표시됨

### FR-002: 결제 실패 콜백 처리
**설명**: 사용자가 토스페이먼츠를 통해 결제를 시도했지만 실패한 경우 실패 콜백을 처리합니다.

**요구사항**:
- 토스페이먼츠에서 전달된 실패 정보를 받아야 함
- 결제 실패 원인을 사용자에게 명확하게 표시해야 함
- 결제 실패 원인을 이해하기 쉬운 언어로 변환해야 함
- 재시도 옵션을 제공해야 함
- 이전 페이지로 돌아갈 수 있는 옵션을 제공해야 함
- 결제 실패 정보가 적절하게 기록되어야 함

**검증 기준**:
- 토스페이먼츠에서 전달된 실패 정보가 정상적으로 수신됨
- 결제 실패 원인이 명확하게 표시됨
- 결제 실패 원인이 사용자에게 이해하기 쉬운 언어로 표시됨
- 재시도 옵션이 제공됨
- 이전 페이지로 돌아갈 수 있는 옵션이 제공됨

### FR-003: 결제 승인 처리
**설명**: 토스페이먼츠를 통해 완료된 결제를 최종 승인 처리합니다.

**요구사항**:
- 결제 정보를 기반으로 결제 승인을 요청해야 함
- 결제 승인 결과를 확인해야 함
- 결제 승인 성공 시 주문 상태를 업데이트해야 함
- 결제 승인 실패 시 적절한 오류 처리를 해야 함
- 결제 승인 처리 중 재시도 로직을 제공해야 함 (네트워크 오류 등 일시적 오류의 경우)

**검증 기준**:
- 결제 승인이 정상적으로 처리됨
- 결제 승인 성공 시 주문 상태가 올바르게 업데이트됨
- 결제 승인 실패 시 적절한 오류 메시지가 표시됨
- 일시적 오류 발생 시 재시도가 정상적으로 작동함

### FR-004: 타임캡슐 대기실 생성 및 이동
**설명**: 결제 승인 성공 시 타임캡슐 대기실을 생성하고 사용자를 대기실 페이지로 이동시킵니다.

**요구사항**:
- 결제 승인 성공 시 타임캡슐 대기실을 생성해야 함
- 대기실 생성에 필요한 정보를 결제 정보와 주문 정보에서 가져와야 함
- 대기실 생성 성공 시 사용자를 대기실 페이지로 이동시켜야 함
- 대기실 생성 실패 시 적절한 오류 처리를 해야 함
- 대기실 생성 중 로딩 상태를 표시해야 함

**검증 기준**:
- 결제 승인 성공 시 타임캡슐 대기실이 생성됨
- 대기실 생성에 필요한 정보가 정확하게 전달됨
- 대기실 생성 성공 시 사용자가 대기실 페이지로 이동함
- 대기실 생성 실패 시 적절한 오류 메시지가 표시됨
- 대기실 생성 중 로딩 상태가 표시됨

### FR-005: 결제 결과 표시
**설명**: 사용자에게 결제 성공 또는 실패 결과를 명확하게 표시합니다.

**요구사항**:
- 결제 성공 시 성공 메시지를 표시해야 함
- 결제 실패 시 실패 원인을 명확하게 표시해야 함
- 결제 결과 표시가 사용자에게 이해하기 쉬워야 함
- 결제 결과 표시 후 다음 액션을 안내해야 함
- 결제 결과 표시가 시각적으로 명확해야 함

**검증 기준**:
- 결제 성공 시 성공 메시지가 명확하게 표시됨
- 결제 실패 시 실패 원인이 명확하게 표시됨
- 결제 결과 표시가 사용자에게 이해하기 쉬움
- 결제 결과 표시 후 다음 액션이 명확하게 안내됨
- 결제 결과 표시가 시각적으로 명확함

### FR-006: 오류 처리 및 사용자 안내
**설명**: 결제 승인 및 콜백 처리 과정에서 발생할 수 있는 오류를 적절하게 처리하고 사용자에게 안내합니다.

**요구사항**:
- 네트워크 오류 발생 시 명확한 오류 메시지를 표시해야 함
- 서버 오류 발생 시 적절한 안내를 제공해야 함
- 결제 승인 실패 시 실패 원인을 명확하게 안내해야 함
- 오류 발생 시 사용자가 취할 수 있는 조치를 안내해야 함
- 오류 메시지는 사용자가 이해하기 쉬운 언어로 작성되어야 함
- 일시적 오류의 경우 재시도 옵션을 제공해야 함

**검증 기준**:
- 네트워크 오류 발생 시 명확한 오류 메시지가 표시됨
- 서버 오류 발생 시 적절한 안내가 제공됨
- 결제 승인 실패 시 실패 원인이 명확하게 안내됨
- 오류 발생 시 사용자가 취할 수 있는 조치가 안내됨
- 오류 메시지가 사용자에게 이해하기 쉬움
- 일시적 오류의 경우 재시도 옵션이 제공됨

---

## 🔑 핵심 엔티티

### 결제 정보 (Payment)
- **의미**: 토스페이먼츠를 통해 완료된 결제에 대한 정보
- **주요 속성**:
  - 결제 키: 토스페이먼츠에서 발급한 결제 고유 식별자
  - 주문 ID: 결제와 연결된 주문 식별자
  - 결제 금액: 실제 결제된 금액
  - 결제 상태: 결제의 현재 상태 (대기, 완료, 실패)
  - 결제 수단: 사용한 결제 수단 정보
  - 승인 일시: 결제가 승인된 일시

### 주문 (Order)
- **의미**: 결제와 연결된 타임캡슐 주문 정보
- **주요 속성**:
  - 주문 ID: 주문을 식별하는 고유 식별자
  - 주문 상태: 주문의 현재 상태 (결제 대기, 결제 완료, 취소됨, 실패)
  - 결제 정보: 주문과 연결된 결제 정보

### 타임캡슐 대기실 (Capsule Waiting Room)
- **의미**: 결제 완료 후 생성되는 타임캡슐 대기실
- **주요 속성**:
  - 대기실 ID: 대기실을 식별하는 고유 식별자
  - 주문 ID: 대기실과 연결된 주문 식별자
  - 캡슐명: 타임캡슐의 이름
  - 참여 인원수: 타임캡슐에 참여할 인원 수
  - 생성 일시: 대기실이 생성된 일시

---

## 🚀 성공 기준

### 측정 가능한 결과

- **SC-001**: 결제 성공 콜백 페이지 로드 후 결제 승인 처리 완료 시간이 3초 이하
- **SC-002**: 결제 승인 성공률이 98% 이상
- **SC-003**: 타임캡슐 대기실 생성 성공률이 95% 이상
- **SC-004**: 결제 성공 후 대기실 페이지 이동 성공률이 100%
- **SC-005**: 사용자가 결제 완료를 인지하는 데 걸리는 시간이 5초 이하
- **SC-006**: 결제 실패 콜백 페이지 로드 후 실패 원인 표시 시간이 2초 이하
- **SC-007**: 사용자가 결제 실패 원인을 파악하는 데 걸리는 시간이 1분 이하
- **SC-008**: 결제 승인 처리 중 오류 발생 시 오류 메시지 표시 시간이 1초 이하
- **SC-009**: 결제 승인 처리 중 일시적 오류 재시도 성공률이 80% 이상

---

## 🚧 비기능 요구사항 (NFR)

### 성능
- **NFR-001**: 결제 성공 콜백 페이지 로드 시간이 2초 이하
- **NFR-002**: 결제 승인 처리 응답 시간이 2초 이하
- **NFR-003**: 타임캡슐 대기실 생성 응답 시간이 2초 이하
- **NFR-004**: 결제 실패 콜백 페이지 로드 시간이 2초 이하

### 보안
- **NFR-005**: 모든 API 요청에 인증 토큰이 포함되어야 함
- **NFR-006**: 결제 정보가 안전하게 전송되어야 함
- **NFR-007**: 결제 승인 요청이 무단으로 접근되지 않도록 보호되어야 함
- **NFR-008**: 토스페이먼츠에서 전달된 결제 정보의 유효성을 검증해야 함

### 접근성
- **NFR-009**: 모든 정보가 스크린 리더를 통해 읽을 수 있어야 함
- **NFR-010**: 키보드만으로 모든 기능에 접근할 수 있어야 함
- **NFR-011**: 모든 인터랙티브 요소의 최소 터치 타겟 크기가 44px × 44px 이상

### 사용자 경험
- **NFR-012**: 결제 결과가 명확하고 이해하기 쉽게 표시되어야 함
- **NFR-013**: 결제 승인 처리 중 사용자가 진행 상황을 파악할 수 있어야 함
- **NFR-014**: 결제 실패 시 명확한 안내와 해결 방법을 제시해야 함
- **NFR-015**: 결제 성공 후 자동으로 다음 단계로 이동하여 사용자 이탈을 방지해야 함

### 호환성
- **NFR-016**: 주요 모바일 브라우저(Chrome, Safari, Firefox)에서 정상 동작
- **NFR-017**: 다양한 모바일 기기 화면 크기에서 레이아웃이 일관되게 표시됨

---

## 🔍 엣지 케이스 및 예외 상황

### EC-001: 결제 정보가 제공되지 않은 경우
**상황**: 사용자가 결제 정보 없이 콜백 페이지에 직접 접근

**처리 방법**:
- 적절한 오류 메시지를 표시
- 결제 페이지로 이동할 수 있는 안내 제공

### EC-002: 결제 승인 처리 실패
**상황**: 결제는 완료되었지만 결제 승인 API 호출이 실패

**에러 코드별 처리**:
- **400 AMOUNT_MISMATCH**: 결제 금액 불일치 → "결제 금액이 주문 금액과 일치하지 않습니다." 메시지 표시
- **400 ORDER_ALREADY_PAID**: 이미 결제 완료 → "이미 결제가 완료된 주문입니다." 메시지 표시, 주문 상태 확인 후 적절한 페이지로 이동
- **400 TOSS_SECRET_KEY_REQUIRED**: 토스 비밀키 설정 오류 → "결제 서비스 설정 오류가 발생했습니다." 메시지 표시
- **400 TOSS_CONFIRM_FAILED**: 토스 승인 실패 → "결제 승인 처리 중 오류가 발생했습니다." 메시지 표시, 재시도 옵션 제공
- **401 ORDER_NOT_OWNED**: 본인의 주문이 아님 → "본인의 주문이 아닙니다." 메시지 표시
- **404 ORDER_NOT_FOUND**: 주문을 찾을 수 없음 → "주문을 찾을 수 없습니다." 메시지 표시
- **404 PRODUCT_NOT_FOUND_OR_INVALID**: 유효하지 않은 상품 → "유효하지 않은 상품입니다." 메시지 표시

**일반 처리 방법**:
- 명확한 오류 메시지를 표시 (에러 코드를 사용자 친화적인 메시지로 변환)
- 재시도 옵션 제공 (일시적 오류의 경우)
- 결제 상태를 확인할 수 있는 방법 제공

### EC-003: 결제 승인 처리 중 네트워크 오류
**상황**: 결제 승인 처리 중 네트워크 연결이 끊김

**처리 방법**:
- 네트워크 오류 메시지를 표시
- 자동 재시도 로직 실행 (일시적 오류의 경우)
- 재시도 옵션 제공

### EC-004: 타임캡슐 대기실 생성 실패
**상황**: 결제 승인은 성공했지만 타임캡슐 대기실 생성이 실패

**처리 방법**:
- 명확한 오류 메시지를 표시
- 대기실 생성을 재시도할 수 있는 옵션 제공
- 결제는 완료되었음을 명확히 표시
- 고객 지원 안내 제공

### EC-005: 중복 결제 승인 요청
**상황**: 사용자가 결제 승인 페이지를 새로고침하거나 중복 접근

**처리 방법**:
- 이미 처리된 결제인지 확인
- 이미 처리된 경우 적절한 안내 제공
- 중복 처리 방지

### EC-006: 결제 실패 원인 정보 부족
**상황**: 토스페이먼츠에서 전달된 실패 정보가 부족하거나 불명확

**처리 방법**:
- 일반적인 실패 안내 메시지 표시
- 재시도 옵션 제공
- 고객 지원 안내 제공

---

## 🎨 디자인 제약사항

### Figma 디자인 준수
- **Figma 디자인 참조**: 결제 성공/실패 페이지의 디자인은 Figma 디자인 시안을 참조합니다
- **디자인 정확도**: 모든 컴포넌트의 크기, 간격, 색상, 스타일은 Figma 디자인과 pixel-perfect 수준으로 일치해야 함
- **디자인 토큰 준수**: Figma에서 정의된 색상, 간격, 타이포그래피 등의 디자인 토큰을 프로젝트의 `tailwind.config.js`에 선언된 변수로 import하여 사용
- **중복 선언 금지**: 하드코딩된 색상 값 사용 금지, 기존에 정의된 테마 변수를 재사용

### 레이아웃
- **모바일 기준 고정값**: 레이아웃 너비는 모바일 기준 고정값으로 설정됨
- **일관성**: 모든 페이지에서 레이아웃 구조가 일관되게 유지됨

### 결제 결과 표시
- **정보 구조**: 결제 결과가 명확하고 읽기 쉽게 구조화되어 표시됨
- **시각적 계층**: 중요한 정보(결제 성공/실패 상태 등)가 시각적으로 강조됨
- **액션 안내**: 다음 액션이 명확하게 표시되고 접근하기 쉬움

---

## 📊 성공 지표 (KPI)

### 사용자 경험
- **결제 승인 처리 성공률**: 결제 완료 후 승인 처리가 성공하는 비율이 98% 이상
- **대기실 생성 성공률**: 결제 승인 성공 후 대기실이 생성되는 비율이 95% 이상
- **결제 완료 인지 시간**: 사용자가 결제 완료를 인지하는 데 걸리는 평균 시간이 5초 이하
- **결제 실패 후 재시도율**: 결제 실패 후 사용자가 다시 시도하는 비율이 60% 이상

### 기술적 품질
- **결제 승인 API 성공률**: 결제 승인 API 호출 성공률이 98% 이상
- **대기실 생성 API 성공률**: 대기실 생성 API 호출 성공률이 95% 이상
- **콜백 페이지 로드 성능**: 콜백 페이지 로드 시간이 2초 이하인 비율이 95% 이상
- **오류 처리 정확도**: 오류 발생 시 적절한 메시지 표시 비율이 100%

### 비즈니스 지표
- **결제 완료 전환율**: 결제 완료 후 대기실로 이동하는 비율이 95% 이상
- **사용자 이탈률**: 결제 완료 후 대기실 이동 전 이탈하는 비율이 5% 이하
- **결제 실패 처리 만족도**: 결제 실패 시 사용자가 처리 과정에 만족하는 비율이 80% 이상

---

## 🔗 기술 의존성

### 필수 의존성
- **인증 토큰**: 모든 API 요청 헤더에 `Authorization: Bearer {token}` 형식으로 인증 토큰이 포함되어야 함
- **환경 변수**: 개발 환경에서 사용할 인증 토큰은 `.env.local` 파일의 `NEXT_PUBLIC_DEV_TOKEN` 환경 변수로 관리됨
- **결제 승인 API**: 결제 승인을 위한 API 엔드포인트
- **대기실 생성 API**: 타임캡슐 대기실 생성을 위한 API 엔드포인트
- **주문 상태 API**: 주문 상태 조회 및 업데이트를 위한 API 엔드포인트

### 선택적 의존성
- **로딩 상태 관리**: 결제 승인 처리 중 상태 표시를 위한 상태 관리
- **오류 처리**: 오류 발생 시 사용자에게 안내하기 위한 오류 처리 메커니즘
- **재시도 로직**: 일시적 오류 발생 시 재시도를 위한 로직

---

## 📝 가정사항

### 사용자 환경
- 사용자는 모바일 기기에서 웹 애플리케이션을 주로 사용함
- 사용자는 터치 인터페이스에 익숙함
- 사용자는 온라인 결제 과정에 대해 기본적인 이해를 가지고 있음

### 기술 환경
- 인증된 사용자만 결제 콜백 페이지에 접근할 수 있음
- 개발 환경에서 사용할 인증 토큰은 `.env.local` 파일의 `NEXT_PUBLIC_DEV_TOKEN` 환경 변수로 선언되어 있음
- 모든 API 요청 시 인증 토큰이 필요함
- 토스페이먼츠에서 콜백 URL로 결제 정보가 전달됨

### 비즈니스 규칙
- 결제 승인은 결제 완료 후에만 진행할 수 있음
- 결제 승인 성공 시에만 타임캡슐 대기실을 생성할 수 있음
- 결제 승인 실패 시 주문 상태가 적절하게 관리됨
- 결제 실패 시 주문 상태가 "결제 실패"로 변경됨

### 데이터 전달
- 결제 정보는 URL 쿼리 파라미터를 통해 토스페이먼츠에서 전달됨 (paymentKey, orderId, amount)
- 주문 정보는 결제 정보를 기반으로 조회됨
- 리다이렉트 URL(successUrl/failUrl)은 프론트엔드에서 Toss Payments SDK 호출 시 설정해야 함
- 백엔드는 리다이렉트 URL을 반환하지 않음

---

## 🚧 향후 확장 가능성

### 향후 개선 사항
- 결제 완료 알림 기능 (이메일, SMS 등)
- 결제 내역 조회 기능
- 결제 취소 및 환불 기능
- 결제 재시도 자동화 기능
- 결제 완료 후 추가 옵션 제공

### 확장 가능한 기능
- 여러 결제 수단 지원 (현재는 토스페이먼츠만)
- 결제 완료 후 쿠폰 또는 포인트 적립 기능
- 결제 완료 후 친구 초대 기능
- 결제 완료 후 소셜 공유 기능
