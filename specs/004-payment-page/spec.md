# 결제 페이지 명세서

**Feature Branch**: `feat/payment-page`  
**Created**: 2026-01-26  
**Status**: Draft  
**Input**: User description: "토스 결제를 위한 결제 페이지를 구현합니다."

## 📋 개요

### 프로젝트 목표
사용자가 타임캡슐 생성 과정에서 입력한 정보를 확인하고, 안전하게 결제를 완료하여 타임캡슐 주문을 최종 확정할 수 있는 페이지를 제공합니다.

### 비즈니스 가치
- **결제 완료율 향상**: 명확한 주문 정보 표시와 간편한 결제 프로세스로 결제 완료율 향상
- **신뢰성 확보**: 주문 정보 요약과 결제 금액 명확 표시로 사용자 신뢰도 향상
- **사용자 경험 개선**: 직관적인 결제 인터페이스와 실시간 피드백으로 결제 과정의 사용자 만족도 향상
- **비즈니스 수익화**: 안정적인 결제 시스템을 통한 서비스 수익화 기반 마련

### 범위
- **포함**: 
  - 이전 페이지에서 전달받은 타임캡슐 주문 정보 표시 (캡슐명, 인원수, 가격 등)
  - 주문 정보 요약 및 결제 금액 표시
  - 토스 결제 위젯 연동 및 결제 처리
  - 결제 전 주문 정보 확인 및 검증
  - 결제 완료 후 처리 및 결과 표시
- **제외**: 
  - 주문 생성 API 호출 (이미 타임캡슐 생성 페이지에서 완료됨)
  - 결제 완료 후 추가 페이지 (결제 완료 페이지는 별도 기능)
  - 환불 및 취소 처리 (별도 기능)

---

## 🎯 사용자 시나리오

### US1: 사용자가 주문 정보를 확인하고 결제를 완료 (Priority: P1)

**시나리오**: 사용자가 타임캡슐 생성 페이지에서 주문을 생성한 후 결제 페이지에 접근하여 주문 정보를 확인하고 결제를 완료할 때

**사용자 행동**:
1. 사용자가 타임캡슐 생성 페이지에서 주문을 생성하고 결제 페이지로 이동
2. 사용자가 결제 페이지에서 주문 정보 요약을 확인 (캡슐명, 참여 인원수, 선택한 옵션, 총 금액)
3. 사용자가 결제 금액이 올바른지 확인
4. 사용자가 토스 결제 위젯을 통해 결제 정보를 입력
5. 사용자가 결제를 진행하고 완료
6. 시스템이 결제 결과를 확인하고 처리

**기대 결과**:
- 사용자가 주문 정보를 명확하게 확인할 수 있음
- 결제 금액이 정확하게 표시됨
- 결제 과정이 안전하고 간편함
- 결제 완료 시 적절한 피드백이 제공됨
- 결제 실패 시 명확한 안내가 제공됨

**성공 기준**:
- 사용자가 주문 정보를 확인하는 데 걸리는 시간이 30초 이하
- 결제 페이지 로드 후 주문 정보 표시 시간이 2초 이하
- 결제 완료율이 85% 이상
- 결제 실패 시 사용자가 원인을 파악하는 데 걸리는 시간이 1분 이하

**Acceptance Scenarios**:
1. **Given** 사용자가 타임캡슐 생성 페이지에서 주문을 생성했을 때, **When** 결제 페이지로 이동하면, **Then** 주문 정보가 정확하게 표시됨
2. **Given** 사용자가 결제 페이지에서 주문 정보를 확인했을 때, **When** 결제 금액이 올바른지 확인하면, **Then** 총 금액이 명확하게 표시됨
3. **Given** 사용자가 결제 정보를 입력했을 때, **When** 결제를 진행하면, **Then** 결제가 성공적으로 완료됨
4. **Given** 사용자가 결제를 완료했을 때, **When** 결제 결과가 확인되면, **Then** 적절한 성공 메시지가 표시됨

---

### US2: 사용자가 주문 정보를 확인하고 결제 전에 수정이 필요한 경우 (Priority: P2)

**시나리오**: 사용자가 결제 페이지에서 주문 정보를 확인했을 때 정보가 잘못되었거나 수정이 필요한 경우

**사용자 행동**:
1. 사용자가 결제 페이지에서 주문 정보를 확인
2. 사용자가 주문 정보에 오류를 발견하거나 수정이 필요함을 인지
3. 사용자가 이전 페이지로 돌아가서 정보를 수정
4. 사용자가 수정 후 다시 결제 페이지로 이동

**기대 결과**:
- 사용자가 주문 정보를 쉽게 확인할 수 있음
- 주문 정보가 잘못된 경우 사용자가 이를 쉽게 인지할 수 있음
- 사용자가 이전 페이지로 돌아가 수정할 수 있음
- 수정 후 다시 결제 페이지로 돌아왔을 때 업데이트된 정보가 표시됨

**성공 기준**:
- 사용자가 주문 정보 오류를 인지하는 데 걸리는 시간이 1분 이하
- 주문 정보 수정 후 결제 페이지 재진입 성공률 100%
- 수정된 주문 정보가 정확하게 반영되는 비율 100%

**Acceptance Scenarios**:
1. **Given** 사용자가 결제 페이지에서 주문 정보를 확인했을 때, **When** 정보가 잘못되었다고 판단하면, **Then** 이전 페이지로 돌아갈 수 있는 방법이 제공됨
2. **Given** 사용자가 주문 정보를 수정하고 다시 결제 페이지로 돌아왔을 때, **When** 페이지가 로드되면, **Then** 수정된 주문 정보가 정확하게 표시됨

---

### US3: 사용자가 결제 과정에서 오류를 경험하는 경우 (Priority: P1)

**시나리오**: 사용자가 결제를 진행하는 과정에서 네트워크 오류, 결제 실패, 주문 정보 오류 등의 문제가 발생할 때

**사용자 행동**:
1. 사용자가 결제를 진행
2. 시스템에서 오류가 발생 (네트워크 오류, 결제 실패, 주문 정보 오류 등)
3. 사용자가 오류 메시지를 확인
4. 사용자가 오류 원인을 파악하고 적절한 조치를 취함 (재시도, 이전 페이지로 이동 등)

**기대 결과**:
- 오류 발생 시 명확하고 이해하기 쉬운 오류 메시지가 표시됨
- 사용자가 오류 원인을 쉽게 파악할 수 있음
- 사용자가 적절한 조치를 취할 수 있는 안내가 제공됨
- 결제 실패 시 주문 상태가 적절하게 관리됨

**성공 기준**:
- 오류 메시지 표시 시간이 1초 이하
- 사용자가 오류 원인을 파악하는 데 걸리는 시간이 1분 이하
- 오류 발생 후 사용자가 적절한 조치를 취하는 비율이 70% 이상
- 결제 실패 시 주문 상태 관리 정확도 100%

**Acceptance Scenarios**:
1. **Given** 사용자가 결제를 진행하는 중 네트워크 오류가 발생했을 때, **When** 오류가 감지되면, **Then** 명확한 오류 메시지가 표시되고 재시도 옵션이 제공됨
2. **Given** 사용자가 결제를 진행하는 중 결제가 실패했을 때, **When** 결제 실패가 확인되면, **Then** 실패 원인이 명확하게 표시되고 대안이 제시됨
3. **Given** 사용자가 주문 정보가 유효하지 않을 때, **When** 결제 페이지에 접근하면, **Then** 적절한 오류 메시지가 표시되고 이전 페이지로 이동할 수 있는 안내가 제공됨

---

## 📋 기능 요구사항

### FR-001: 주문 정보 표시
**설명**: 사용자가 이전 페이지에서 생성한 주문 정보를 확인할 수 있도록 표시합니다.

**요구사항**:
- 주문 ID를 기반으로 주문 정보를 조회하여 표시해야 함
- 주문 정보에는 다음이 포함되어야 함:
  - 캡슐명 (타임캡슐 이름)
  - 참여 인원수
  - 선택한 타임 옵션 (오픈 예정일)
  - 선택한 추가 옵션 (사진 개수, 음악 추가 여부, 비디오 추가 여부)
  - 총 결제 금액
- 주문 정보가 로드되는 동안 로딩 상태를 표시해야 함
- 주문 정보 조회 실패 시 적절한 오류 메시지를 표시해야 함
- 주문 정보가 유효하지 않거나 존재하지 않는 경우 적절한 안내를 제공해야 함

**검증 기준**:
- 주문 ID가 제공된 경우 주문 정보가 정상적으로 조회됨
- 모든 주문 정보 항목이 정확하게 표시됨
- 주문 정보 로드 중 로딩 상태가 표시됨
- 주문 정보 조회 실패 시 오류 메시지가 표시됨
- 유효하지 않은 주문 ID인 경우 적절한 안내가 제공됨

### FR-002: 결제 금액 표시
**설명**: 사용자가 결제해야 할 총 금액을 명확하게 확인할 수 있도록 표시합니다.

**요구사항**:
- 총 결제 금액이 명확하게 표시되어야 함
- 결제 금액은 숫자 형식으로 표시되어야 함 (예: 10,000원)
- 결제 금액이 주문 정보와 일치해야 함
- 결제 금액 표시 위치가 사용자가 쉽게 확인할 수 있는 곳이어야 함

**검증 기준**:
- 총 결제 금액이 정확하게 표시됨
- 결제 금액 형식이 사용자에게 이해하기 쉬움
- 결제 금액이 주문 정보의 총 금액과 일치함

### FR-003: 토스 결제 위젯 연동
**설명**: 사용자가 토스 결제 위젯을 통해 안전하게 결제를 진행할 수 있도록 합니다.

**요구사항**:
- 토스 결제 위젯이 정상적으로 로드되어야 함
- 결제 위젯이 주문 정보와 연동되어야 함
- 사용자가 결제 정보를 입력할 수 있어야 함
- 결제 위젯이 안전하게 작동해야 함
- 결제 위젯 로드 실패 시 적절한 오류 메시지를 표시해야 함

**검증 기준**:
- 토스 결제 위젯이 정상적으로 로드됨
- 결제 위젯이 주문 정보와 정확하게 연동됨
- 사용자가 결제 정보를 입력할 수 있음
- 결제 위젯 로드 실패 시 오류 메시지가 표시됨

### FR-004: 결제 진행 및 완료 처리
**설명**: 사용자가 결제를 진행하고 완료했을 때 적절하게 처리합니다.

**요구사항**:
- 사용자가 결제를 진행할 수 있어야 함
- 결제 진행 중에는 진행 상태를 표시해야 함
- 결제 완료 시 결제 결과를 확인하고 처리해야 함
- 결제 완료 후 적절한 피드백을 제공해야 함
- 결제 실패 시 명확한 오류 메시지를 표시해야 함
- 결제 실패 시 재시도 옵션을 제공해야 함

**검증 기준**:
- 사용자가 결제를 정상적으로 진행할 수 있음
- 결제 진행 중 진행 상태가 표시됨
- 결제 완료 시 결제 결과가 정확하게 확인됨
- 결제 완료 후 적절한 피드백이 제공됨
- 결제 실패 시 명확한 오류 메시지가 표시됨
- 결제 실패 시 재시도 옵션이 제공됨

### FR-005: 주문 상태 관리
**설명**: 결제 과정에서 주문 상태를 적절하게 관리합니다.

**요구사항**:
- 결제 전 주문 상태가 올바르게 표시되어야 함
- 결제 진행 중 주문 상태가 적절하게 업데이트되어야 함
- 결제 완료 시 주문 상태가 올바르게 업데이트되어야 함
- 결제 실패 시 주문 상태가 적절하게 관리되어야 함
- 주문 상태 변경 시 사용자에게 적절한 피드백을 제공해야 함

**검증 기준**:
- 결제 전 주문 상태가 정확하게 표시됨
- 결제 진행 중 주문 상태가 적절하게 업데이트됨
- 결제 완료 시 주문 상태가 올바르게 업데이트됨
- 결제 실패 시 주문 상태가 적절하게 관리됨

### FR-006: 오류 처리 및 사용자 안내
**설명**: 결제 과정에서 발생할 수 있는 오류를 적절하게 처리하고 사용자에게 안내합니다.

**요구사항**:
- 네트워크 오류 발생 시 명확한 오류 메시지를 표시해야 함
- 결제 실패 시 실패 원인을 명확하게 안내해야 함
- 주문 정보 오류 시 적절한 안내를 제공해야 함
- 오류 발생 시 사용자가 취할 수 있는 조치를 안내해야 함
- 오류 메시지는 사용자가 이해하기 쉬운 언어로 작성되어야 함

**검증 기준**:
- 네트워크 오류 발생 시 명확한 오류 메시지가 표시됨
- 결제 실패 시 실패 원인이 명확하게 안내됨
- 주문 정보 오류 시 적절한 안내가 제공됨
- 오류 발생 시 사용자가 취할 수 있는 조치가 안내됨
- 오류 메시지가 사용자에게 이해하기 쉬움

---

## 🔑 핵심 엔티티

### 주문 (Order)
- **의미**: 사용자가 타임캡슐 생성 과정에서 생성한 주문 정보
- **주요 속성**:
  - 주문 ID: 주문을 식별하는 고유 식별자
  - 캡슐명: 타임캡슐의 이름
  - 참여 인원수: 타임캡슐에 참여할 인원 수
  - 타임 옵션: 타임캡슐이 열릴 날짜 옵션
  - 커스텀 오픈 날짜: 사용자가 직접 지정한 오픈 날짜 (해당하는 경우)
  - 사진 개수: 포함할 사진 개수
  - 음악 추가 여부: 음악 추가 옵션 선택 여부
  - 비디오 추가 여부: 비디오 추가 옵션 선택 여부
  - 총 금액: 결제해야 할 총 금액
  - 주문 상태: 주문의 현재 상태 (결제 대기, 결제 완료, 취소됨, 실패)

### 결제 정보 (Payment)
- **의미**: 사용자가 진행한 결제에 대한 정보
- **주요 속성**:
  - 결제 금액: 실제 결제된 금액
  - 결제 상태: 결제의 현재 상태 (대기, 완료, 실패)
  - 결제 키: 결제를 식별하는 고유 키
  - 승인 일시: 결제가 승인된 일시

---

## 🚀 성공 기준

### 측정 가능한 결과

- **SC-001**: 사용자가 결제 페이지에 접근한 후 주문 정보가 표시되는 시간이 2초 이하
- **SC-002**: 사용자가 주문 정보를 확인하는 데 걸리는 시간이 30초 이하
- **SC-003**: 결제 완료율이 85% 이상
- **SC-004**: 결제 실패 시 사용자가 오류 원인을 파악하는 데 걸리는 시간이 1분 이하
- **SC-005**: 결제 진행 중 진행 상태 표시 응답 시간이 1초 이하
- **SC-006**: 결제 완료 후 피드백 제공 시간이 2초 이하
- **SC-007**: 주문 정보 조회 성공률이 95% 이상
- **SC-008**: 토스 결제 위젯 로드 성공률이 98% 이상

---

## 🚧 비기능 요구사항 (NFR)

### 성능
- **NFR-001**: 결제 페이지 로드 시간이 2초 이하
- **NFR-002**: 주문 정보 조회 응답 시간이 1초 이하
- **NFR-003**: 토스 결제 위젯 로드 시간이 3초 이하
- **NFR-004**: 결제 진행 중 상태 업데이트 응답 시간이 1초 이하

### 보안
- **NFR-005**: 모든 API 요청에 인증 토큰이 포함되어야 함
- **NFR-006**: 결제 정보가 안전하게 전송되어야 함
- **NFR-007**: 주문 정보가 무단으로 접근되지 않도록 보호되어야 함

### 접근성
- **NFR-008**: 모든 정보가 스크린 리더를 통해 읽을 수 있어야 함
- **NFR-009**: 키보드만으로 모든 기능에 접근할 수 있어야 함
- **NFR-010**: 모든 인터랙티브 요소의 최소 터치 타겟 크기가 44px × 44px 이상

### 사용자 경험
- **NFR-011**: 주문 정보가 명확하고 이해하기 쉽게 표시되어야 함
- **NFR-012**: 결제 과정이 직관적이고 사용자 친화적이어야 함
- **NFR-013**: 오류 메시지가 명확하고 해결 방법을 안내해야 함
- **NFR-014**: 결제 진행 중 사용자가 진행 상황을 파악할 수 있어야 함

### 호환성
- **NFR-015**: 주요 모바일 브라우저(Chrome, Safari, Firefox)에서 정상 동작
- **NFR-016**: 다양한 모바일 기기 화면 크기에서 레이아웃이 일관되게 표시됨
- **NFR-017**: 토스 결제 위젯이 모든 주요 브라우저에서 정상 작동함

---

## 🔍 엣지 케이스 및 예외 상황

### EC-001: 주문 ID가 제공되지 않은 경우
**상황**: 사용자가 주문 ID 없이 결제 페이지에 직접 접근

**처리 방법**:
- 적절한 오류 메시지를 표시
- 타임캡슐 생성 페이지로 이동할 수 있는 안내 제공

### EC-002: 주문 정보 조회 실패
**상황**: 주문 정보 조회 API 호출이 실패하거나 주문이 존재하지 않음

**처리 방법**:
- 명확한 오류 메시지를 표시
- 주문이 존재하지 않는 경우 적절한 안내 제공
- 네트워크 오류인 경우 재시도 옵션 제공

### EC-003: 결제 진행 중 네트워크 오류
**상황**: 사용자가 결제를 진행하는 중 네트워크 연결이 끊김

**처리 방법**:
- 네트워크 오류 메시지를 표시
- 재시도 옵션 제공
- 주문 상태를 적절하게 관리

### EC-004: 결제 실패
**상황**: 결제가 실패함 (카드 한도 초과, 결제 정보 오류 등)

**처리 방법**:
- 결제 실패 원인을 명확하게 안내
- 재시도 옵션 제공
- 주문 상태를 적절하게 업데이트

### EC-005: 결제 완료 후 주문 상태 업데이트 실패
**상황**: 결제는 완료되었지만 주문 상태 업데이트가 실패

**처리 방법**:
- 결제 완료 상태를 유지
- 주문 상태 업데이트를 재시도
- 사용자에게 적절한 안내 제공

### EC-006: 브라우저 뒤로가기 후 다시 접근
**상황**: 사용자가 결제 페이지에서 뒤로가기를 한 후 다시 접근

**처리 방법**:
- 주문 상태를 확인하여 적절한 화면 표시
- 이미 결제가 완료된 경우 적절한 안내 제공
- 결제 대기 중인 경우 결제를 계속 진행할 수 있도록 함

---

## 🎨 디자인 제약사항

### Figma 디자인 준수
- **Figma 디자인 참조**: 결제 페이지의 디자인은 Figma 디자인 시안을 참조합니다
- **Figma 링크**: https://www.figma.com/design/KJVVnKITMTcrf9qIS7chiy/%ED%83%80%EC%9E%84%EC%BA%A1%EC%8A%90---%EC%9D%B4%EC%8A%A4%ED%84%B0%EC%97%90%EA%B7%B8--%EB%B3%B5%EC%82%AC-?node-id=429-320&t=qSVsqDsyM3lEU153-4
- **디자인 정확도**: 모든 컴포넌트의 크기, 간격, 색상, 스타일은 Figma 디자인과 pixel-perfect 수준으로 일치해야 함
- **디자인 토큰 준수**: Figma에서 정의된 색상, 간격, 타이포그래피 등의 디자인 토큰을 프로젝트의 `tailwind.config.js`에 선언된 변수로 import하여 사용
- **중복 선언 금지**: 하드코딩된 색상 값 사용 금지, 기존에 정의된 테마 변수를 재사용

### 레이아웃
- **모바일 기준 고정값**: 레이아웃 너비는 모바일 기준 고정값으로 설정됨
- **일관성**: 모든 페이지에서 레이아웃 구조가 일관되게 유지됨

### 주문 정보 표시
- **정보 구조**: 주문 정보가 명확하고 읽기 쉽게 구조화되어 표시됨
- **시각적 계층**: 중요한 정보(결제 금액 등)가 시각적으로 강조됨

### 결제 위젯
- **통합성**: 토스 결제 위젯이 페이지 디자인과 자연스럽게 통합됨
- **가시성**: 결제 위젯이 명확하게 표시되고 사용자가 쉽게 접근할 수 있음

---

## 📊 성공 지표 (KPI)

### 사용자 경험
- **결제 완료율**: 결제 페이지 접근 후 결제를 완료하는 비율이 85% 이상
- **주문 정보 확인 시간**: 사용자가 주문 정보를 확인하는 데 걸리는 평균 시간이 30초 이하
- **결제 진행 시간**: 결제를 시작한 후 완료하는 데 걸리는 평균 시간이 3분 이하
- **재시도율**: 결제 실패 후 사용자가 다시 시도하는 비율이 60% 이상

### 기술적 품질
- **주문 정보 조회 성공률**: 주문 정보 조회 API 호출 성공률이 95% 이상
- **결제 위젯 로드 성공률**: 토스 결제 위젯 로드 성공률이 98% 이상
- **페이지 로드 성능**: 결제 페이지 로드 시간이 2초 이하인 비율이 95% 이상
- **오류 처리 정확도**: 오류 발생 시 적절한 메시지 표시 비율이 100%

### 비즈니스 지표
- **결제 전환율**: 타임캡슐 생성 페이지에서 결제 페이지로 이동한 사용자 중 결제를 완료하는 비율이 85% 이상
- **사용자 만족도**: 사용자가 결제 과정에 대해 만족하는 비율이 80% 이상
- **결제 실패율**: 결제 시도 중 실패하는 비율이 15% 이하

---

## 🔗 기술 의존성

### 필수 의존성
- **인증 토큰**: 모든 API 요청 헤더에 `Authorization: Bearer {token}` 형식으로 인증 토큰이 포함되어야 함
- **환경 변수**: 개발 환경에서 사용할 인증 토큰은 `.env.local` 파일의 `NEXT_PUBLIC_DEV_TOKEN` 환경 변수로 관리됨
- **주문 API**: 주문 정보 조회를 위한 API 엔드포인트
- **토스 결제 SDK**: 토스 결제 위젯 연동을 위한 SDK

### 선택적 의존성
- **로딩 상태 관리**: 주문 정보 로드 중 상태 표시를 위한 상태 관리
- **오류 처리**: 오류 발생 시 사용자에게 안내하기 위한 오류 처리 메커니즘

---

## 📝 가정사항

### 사용자 환경
- 사용자는 모바일 기기에서 웹 애플리케이션을 주로 사용함
- 사용자는 터치 인터페이스에 익숙함
- 사용자는 온라인 결제 과정에 대해 기본적인 이해를 가지고 있음

### 기술 환경
- 인증된 사용자만 결제 페이지에 접근할 수 있음
- 개발 환경에서 사용할 인증 토큰은 `.env.local` 파일의 `NEXT_PUBLIC_DEV_TOKEN` 환경 변수로 선언되어 있음
- 모든 API 요청 시 인증 토큰이 필요함
- 주문 정보는 타임캡슐 생성 페이지에서 이미 생성되어 있음

### 비즈니스 규칙
- 결제는 주문 생성 후에만 진행할 수 있음
- 주문 상태가 "결제 대기" 상태인 경우에만 결제를 진행할 수 있음
- 결제 완료 후 주문 상태가 "결제 완료"로 변경됨
- 결제 실패 시 주문 상태가 적절하게 관리됨

### 데이터 전달
- 주문 ID는 URL 쿼리 파라미터(`orderId`)를 통해 전달됨
- 주문 정보는 주문 ID를 기반으로 API를 통해 조회됨

---

## 🚧 향후 확장 가능성

### 향후 개선 사항
- 결제 완료 후 결제 완료 페이지로 이동
- 결제 내역 조회 기능
- 결제 취소 및 환불 기능
- 여러 결제 수단 지원 (현재는 토스 결제만)
- 결제 정보 저장 기능 (선택적)

### 확장 가능한 기능
- 결제 할인 쿠폰 적용 기능
- 결제 수단 선택 기능
- 결제 약관 동의 기능
- 결제 완료 알림 기능
