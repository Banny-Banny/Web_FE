# 타임캡슐 대기실 진입 및 참여 명세서

**Feature Branch**: `feat/timecapsule-waiting-room`  
**Created**: 2026-01-27  
**Status**: Draft  
**Input**: User description: "결제 완료 후 타임캡슐 대기실 진입 기능을 구현합니다. 결제가 완료된 사용자(방장)가 타임캡슐 대기실에 진입하고, 캡슐 설정에서 설정한 정보를 불러와 표시하는 기능입니다."

## 📋 개요

### 프로젝트 목표
결제가 완료된 사용자(방장)가 타임캡슐 대기실에 진입하고, 캡슐 설정에서 설정한 정보를 불러와 표시합니다. 대기실에서는 방장이 타임캡슐 생성 전 준비 단계를 확인할 수 있습니다.

### 비즈니스 가치
- **사용자 경험 연속성**: 결제 완료 후 즉시 대기실에 진입하여 다음 단계로 자연스럽게 진행할 수 있어 사용자 이탈 방지
- **설정 정보 확인**: 캡슐 설정에서 입력한 정보를 대기실에서 확인하여 사용자가 설정한 내용을 재확인할 수 있음
- **참여자 관리 효율성**: 대기실에서 참여자들의 상태를 확인하고 관리할 수 있어 타임캡슐 생성 전 준비 단계를 체계적으로 진행
- **사용자 만족도 향상**: 명확한 대기실 진입 과정과 설정 정보 표시로 사용자 만족도 향상

### 범위
- **포함**: 
  - 결제 완료 후 타임캡슐 대기실 자동 생성
  - 방장(결제 완료자)의 대기실 페이지 진입
  - 대기실 설정값 조회 및 표시 (캡슐 설정에서 설정한 정보)
  - 대기실 상세 정보 조회 및 표시 (참여자 목록, 대기실 상태 등)
- **제외**: 
  - 결제 처리 (결제 콜백 기능에서 처리됨)
  - 타임캡슐 실제 생성 (대기실 이후 단계)
  - 초대 코드 생성 및 공유 기능 (향후 구현 예정)
  - 초대 코드를 통한 참여자 대기실 조회 (향후 구현 예정)
  - 참여자의 대기실 참여(슬롯 배정) 및 진입 (향후 구현 예정)
  - 대기실 내 채팅 또는 메시지 기능 (별도 기능)
  - 대기실 설정 변경 (별도 기능)
  - 대기실 나가기 또는 삭제 (별도 기능)

---

## 🎯 사용자 시나리오

### US1: 방장이 결제 완료 후 대기실에 진입 (Priority: P1)

**시나리오**: 사용자가 결제를 완료한 후 자동으로 생성된 타임캡슐 대기실에 진입할 때

**사용자 행동**:
1. 사용자가 결제를 완료하고 결제 성공 콜백 페이지로 이동
2. 시스템이 타임캡슐 대기실을 자동으로 생성
3. 사용자가 대기실 페이지로 자동 이동하여 대기실 정보를 확인
4. 사용자가 캡슐 설정에서 설정한 정보(캡슐명, 참여 인원수, 오픈 예정일 등)를 확인

**기대 결과**:
- 결제 완료 후 대기실이 자동으로 생성됨
- 사용자가 대기실 페이지로 자연스럽게 이동함
- 캡슐 설정에서 설정한 정보가 대기실에 정확하게 표시됨
- 대기실 정보(캡슐명, 참여 인원수, 오픈 예정일 등)가 명확하게 표시됨
- 사용자가 대기실 상태를 쉽게 파악할 수 있음

**성공 기준**:
- 결제 완료 후 대기실 생성 성공률이 95% 이상
- 결제 완료 후 대기실 페이지 이동 성공률이 100%
- 대기실 페이지 로드 후 정보 표시 시간이 2초 이하
- 캡슐 설정 정보 조회 및 표시 시간이 2초 이하
- 사용자가 대기실 정보를 파악하는 데 걸리는 시간이 10초 이하

**Acceptance Scenarios**:
1. **Given** 사용자가 결제를 완료했을 때, **When** 결제 성공 콜백이 처리되면, **Then** 타임캡슐 대기실이 자동으로 생성됨
2. **Given** 타임캡슐 대기실이 생성되었을 때, **When** 사용자가 대기실 페이지에 접근하면, **Then** 대기실 정보가 명확하게 표시됨
3. **Given** 사용자가 대기실 페이지에 진입했을 때, **When** 캡슐 설정 정보를 확인하면, **Then** 캡슐 설정에서 설정한 정보가 정확하게 표시됨

---

### US2: 방장이 대기실에서 참여자 목록을 확인 (Priority: P2)

**시나리오**: 방장이 대기실 페이지에서 현재 참여한 참여자들의 목록을 확인할 때

**사용자 행동**:
1. 방장이 대기실 페이지에 진입
2. 방장이 참여자 목록 섹션을 확인
3. 방장이 현재 참여한 참여자 수와 최대 참여 인원수를 확인
4. 방장이 각 참여자의 정보를 확인

**기대 결과**:
- 참여자 목록이 명확하게 표시됨
- 현재 참여 인원수와 최대 참여 인원수가 정확하게 표시됨
- 각 참여자의 정보가 이해하기 쉽게 표시됨
- 참여자 목록이 실시간으로 업데이트됨 (새로운 참여자가 추가되면)

**성공 기준**:
- 참여자 목록 표시 시간이 2초 이하
- 참여자 정보 정확도가 100%
- 참여자 목록 업데이트 지연 시간이 5초 이하
- 사용자가 참여자 목록을 파악하는 데 걸리는 시간이 10초 이하

**Acceptance Scenarios**:
1. **Given** 방장이 대기실 페이지에 진입했을 때, **When** 참여자 목록을 확인하면, **Then** 현재 참여한 모든 참여자가 표시됨
2. **Given** 새로운 참여자가 대기실에 참여했을 때, **When** 방장이 참여자 목록을 확인하면, **Then** 새로운 참여자가 목록에 추가되어 표시됨
3. **Given** 방장이 참여자 목록을 확인했을 때, **When** 참여 인원수를 확인하면, **Then** 현재 참여 인원수와 최대 참여 인원수가 정확하게 표시됨

---

## 📋 기능 요구사항

### FR-001: 타임캡슐 대기실 자동 생성
**설명**: 결제 완료 후 타임캡슐 대기실을 자동으로 생성합니다.

**요구사항**:
- 결제 완료 후 대기실 생성 API를 호출해야 함
- 대기실 생성에 필요한 정보를 결제 정보와 주문 정보에서 가져와야 함
- 대기실 생성 성공 시 대기실 ID를 받아야 함
- 대기실 생성 실패 시 적절한 오류 처리를 해야 함
- 대기실 생성 중 로딩 상태를 표시해야 함

**검증 기준**:
- 결제 완료 후 대기실이 자동으로 생성됨
- 대기실 생성에 필요한 정보가 정확하게 전달됨
- 대기실 생성 성공 시 대기실 ID가 정상적으로 수신됨
- 대기실 생성 실패 시 적절한 오류 메시지가 표시됨
- 대기실 생성 중 로딩 상태가 표시됨

### FR-002: 방장의 대기실 페이지 진입
**설명**: 결제 완료 후 생성된 대기실에 방장이 진입합니다.

**요구사항**:
- 대기실 ID를 기반으로 대기실 상세 정보를 조회해야 함
- 대기실 설정값을 조회해야 함 (캡슐 설정에서 설정한 정보)
- 대기실 정보(캡슐명, 참여 인원수, 오픈 예정일 등)를 표시해야 함
- 참여자 목록을 표시해야 함
- 대기실 정보 조회 중 로딩 상태를 표시해야 함
- 대기실 정보 조회 실패 시 적절한 오류 처리를 해야 함

**검증 기준**:
- 대기실 상세 정보가 정상적으로 조회됨
- 대기실 설정값이 정상적으로 조회됨
- 캡슐 설정에서 설정한 정보가 정확하게 표시됨
- 대기실 정보가 명확하게 표시됨
- 참여자 목록이 정확하게 표시됨
- 대기실 정보 조회 중 로딩 상태가 표시됨
- 대기실 정보 조회 실패 시 적절한 오류 메시지가 표시됨

### FR-003: 대기실 정보 표시
**설명**: 대기실 페이지에서 대기실 정보를 표시합니다.

**요구사항**:
- 캡슐명을 표시해야 함 (캡슐 설정에서 설정한 값)
- 참여 인원수(현재/최대)를 표시해야 함
- 오픈 예정일을 표시해야 함 (캡슐 설정에서 설정한 값)
- 캡슐 테마/디자인 정보를 표시해야 함 (캡슐 설정에서 설정한 값)
- 참여자 목록을 표시해야 함
- 대기실 상태를 표시해야 함
- 정보가 명확하고 읽기 쉽게 구조화되어 표시되어야 함

**검증 기준**:
- 캡슐명이 캡슐 설정에서 설정한 값과 정확하게 일치하여 표시됨
- 참여 인원수가 정확하게 표시됨
- 오픈 예정일이 캡슐 설정에서 설정한 값과 정확하게 일치하여 표시됨
- 캡슐 테마/디자인 정보가 캡슐 설정에서 설정한 값과 정확하게 일치하여 표시됨
- 참여자 목록이 정확하게 표시됨
- 대기실 상태가 정확하게 표시됨
- 정보가 명확하고 읽기 쉽게 구조화되어 표시됨

### FR-004: 참여자 목록 표시
**설명**: 대기실 페이지에서 현재 참여한 참여자들의 목록을 표시합니다.

**요구사항**:
- 참여자 목록을 조회해야 함
- 각 참여자의 정보를 표시해야 함
- 참여자 목록이 실시간으로 업데이트되어야 함 (새로운 참여자가 추가되면)
- 참여자 목록이 비어있는 경우 적절한 안내를 제공해야 함
- 참여자 목록 조회 중 로딩 상태를 표시해야 함
- 참여자 목록 조회 실패 시 적절한 오류 처리를 해야 함

**검증 기준**:
- 참여자 목록이 정상적으로 조회됨
- 각 참여자의 정보가 정확하게 표시됨
- 참여자 목록이 실시간으로 업데이트됨
- 참여자 목록이 비어있는 경우 적절한 안내가 제공됨
- 참여자 목록 조회 중 로딩 상태가 표시됨
- 참여자 목록 조회 실패 시 적절한 오류 메시지가 표시됨

### FR-005: 오류 처리 및 사용자 안내
**설명**: 대기실 진입 및 참여 과정에서 발생할 수 있는 오류를 적절하게 처리하고 사용자에게 안내합니다.

**요구사항**:
- 네트워크 오류 발생 시 명확한 오류 메시지를 표시해야 함
- 서버 오류 발생 시 적절한 안내를 제공해야 함
- 대기실 조회 실패 시 실패 원인을 명확하게 안내해야 함
- 대기실 설정값 조회 실패 시 실패 원인을 명확하게 안내해야 함
- 오류 발생 시 사용자가 취할 수 있는 조치를 안내해야 함
- 오류 메시지는 사용자가 이해하기 쉬운 언어로 작성되어야 함
- 일시적 오류의 경우 재시도 옵션을 제공해야 함

**검증 기준**:
- 네트워크 오류 발생 시 명확한 오류 메시지가 표시됨
- 서버 오류 발생 시 적절한 안내가 제공됨
- 대기실 조회 실패 시 실패 원인이 명확하게 안내됨
- 대기실 설정값 조회 실패 시 실패 원인이 명확하게 안내됨
- 오류 발생 시 사용자가 취할 수 있는 조치가 안내됨
- 오류 메시지가 사용자에게 이해하기 쉬움
- 일시적 오류의 경우 재시도 옵션이 제공됨

---

## 🔑 핵심 엔티티

### 타임캡슐 대기실 (Capsule Waiting Room)
- **의미**: 결제 완료 후 생성되는 타임캡슐 대기실
- **주요 속성**:
  - 대기실 ID: 대기실을 식별하는 고유 식별자
  - 주문 ID: 대기실과 연결된 주문 식별자
  - 캡슐명: 타임캡슐의 이름
  - 참여 인원수: 타임캡슐에 참여할 인원 수 (현재/최대)
  - 오픈 예정일: 타임캡슐이 오픈될 예정일 (캡슐 설정에서 설정한 값)
  - 캡슐 테마/디자인: 타임캡슐의 테마 또는 디자인 정보 (캡슐 설정에서 설정한 값)
  - 생성 일시: 대기실이 생성된 일시
  - 대기실 상태: 대기실의 현재 상태 (대기 중, 진행 중, 완료됨)

### 참여자 (Participant)
- **의미**: 타임캡슐 대기실에 참여한 사용자
- **주요 속성**:
  - 참여자 ID: 참여자를 식별하는 고유 식별자
  - 사용자 ID: 참여자의 사용자 식별자
  - 슬롯 번호: 참여자에게 배정된 슬롯 번호
  - 참여 일시: 참여자가 대기실에 참여한 일시
  - 참여자 역할: 참여자의 역할 (방장, 참여자)

---

## 🚀 성공 기준

### 측정 가능한 결과

- **SC-001**: 결제 완료 후 대기실 생성 성공률이 95% 이상
- **SC-002**: 결제 완료 후 대기실 페이지 이동 성공률이 100%
- **SC-003**: 대기실 페이지 로드 후 정보 표시 시간이 2초 이하
- **SC-004**: 캡슐 설정 정보 조회 및 표시 시간이 2초 이하
- **SC-005**: 사용자가 대기실 정보를 파악하는 데 걸리는 시간이 10초 이하
- **SC-006**: 참여자 목록 표시 시간이 2초 이하
- **SC-007**: 참여자 정보 정확도가 100%
- **SC-008**: 참여자 목록 업데이트 지연 시간이 5초 이하

---

## 🚧 비기능 요구사항 (NFR)

### 성능
- **NFR-001**: 대기실 페이지 로드 시간이 2초 이하
- **NFR-002**: 대기실 정보 조회 응답 시간이 2초 이하
- **NFR-003**: 대기실 설정값 조회 응답 시간이 2초 이하
- **NFR-004**: 참여자 목록 조회 응답 시간이 2초 이하

### 보안
- **NFR-005**: 모든 API 요청에 인증 토큰이 포함되어야 함
- **NFR-006**: 대기실 정보가 인증된 사용자에게만 제공되어야 함
- **NFR-007**: 참여자 정보가 적절하게 보호되어야 함

### 접근성
- **NFR-008**: 모든 정보가 스크린 리더를 통해 읽을 수 있어야 함
- **NFR-009**: 키보드만으로 모든 기능에 접근할 수 있어야 함
- **NFR-010**: 모든 인터랙티브 요소의 최소 터치 타겟 크기가 44px × 44px 이상

### 사용자 경험
- **NFR-011**: 대기실 정보가 명확하고 이해하기 쉽게 표시되어야 함
- **NFR-012**: 캡슐 설정 정보가 정확하게 표시되어야 함
- **NFR-013**: 참여자 목록이 명확하게 표시되어야 함
- **NFR-014**: 오류 메시지가 사용자에게 이해하기 쉬운 언어로 작성되어야 함
- **NFR-015**: 대기실 진입 과정이 직관적이고 자연스러워야 함

### 호환성
- **NFR-016**: 주요 모바일 브라우저(Chrome, Safari, Firefox)에서 정상 동작
- **NFR-017**: 다양한 모바일 기기 화면 크기에서 레이아웃이 일관되게 표시됨
- **NFR-018**: 모바일 기준 375px 고정 레이아웃 지원

---

## 🔍 엣지 케이스 및 예외 상황

### EC-001: 대기실 생성 실패
**상황**: 결제 완료 후 대기실 생성 API 호출이 실패

**처리 방법**:
- 명확한 오류 메시지를 표시
- 대기실 생성을 재시도할 수 있는 옵션 제공
- 결제는 완료되었음을 명확히 표시
- 고객 지원 안내 제공

### EC-002: 대기실 정보 조회 실패
**상황**: 대기실 정보 조회 API 호출이 실패

**처리 방법**:
- 명확한 오류 메시지를 표시
- 재시도 옵션 제공
- 네트워크 오류의 경우 네트워크 연결 확인 안내

### EC-003: 대기실 설정값 조회 실패
**상황**: 대기실 설정값 조회 API 호출이 실패

**처리 방법**:
- 명확한 오류 메시지를 표시
- 재시도 옵션 제공
- 네트워크 오류의 경우 네트워크 연결 확인 안내

### EC-004: 인증 토큰 만료
**상황**: 대기실 진입 또는 참여 과정에서 인증 토큰이 만료

**처리 방법**:
- 인증 토큰 만료 메시지를 표시
- 로그인 페이지로 이동할 수 있는 옵션 제공
- 인증 토큰 갱신 후 재시도 옵션 제공

### EC-005: 권한 없는 사용자의 대기실 접근
**상황**: 인증되지 않은 사용자 또는 권한이 없는 사용자가 대기실에 접근

**처리 방법**:
- 권한 없음 메시지를 표시
- 로그인 페이지로 이동할 수 있는 옵션 제공
- 적절한 접근 권한이 필요함을 안내

---

## 🎨 디자인 제약사항

### Figma 디자인 준수
- **Figma 디자인 참조**: 대기실 페이지의 디자인은 Figma 디자인 시안을 참조합니다
- **디자인 정확도**: 모든 컴포넌트의 크기, 간격, 색상, 스타일은 Figma 디자인과 pixel-perfect 수준으로 일치해야 함
- **디자인 토큰 준수**: Figma에서 정의된 색상, 간격, 타이포그래피 등의 디자인 토큰을 프로젝트의 `tailwind.config.js`에 선언된 변수로 import하여 사용
- **중복 선언 금지**: 하드코딩된 색상 값 사용 금지, 기존에 정의된 테마 변수를 재사용

### 레이아웃
- **모바일 기준 고정값**: 레이아웃 너비는 모바일 기준 375px 고정값으로 설정됨
- **일관성**: 모든 페이지에서 레이아웃 구조가 일관되게 유지됨

### 대기실 정보 표시
- **정보 구조**: 대기실 정보가 명확하고 읽기 쉽게 구조화되어 표시됨
- **시각적 계층**: 중요한 정보(캡슐명, 참여 인원수 등)가 시각적으로 강조됨
- **액션 안내**: 다음 액션이 명확하게 표시되고 접근하기 쉬움

### 캡슐 설정 정보 표시
- **정확성**: 캡슐 설정에서 설정한 정보가 정확하게 표시됨
- **가독성**: 캡슐 설정 정보가 명확하고 읽기 쉽게 표시됨
- **일관성**: 캡슐 설정 페이지에서 설정한 값과 대기실에 표시되는 값이 일치함

---

## 📊 성공 지표 (KPI)

### 사용자 경험
- **대기실 생성 성공률**: 결제 완료 후 대기실이 생성되는 비율이 95% 이상
- **대기실 진입 성공률**: 결제 완료 후 대기실 페이지로 이동하는 비율이 100%
- **캡슐 설정 정보 표시 정확도**: 캡슐 설정에서 설정한 정보가 대기실에 정확하게 표시되는 비율이 100%
- **대기실 정보 파악 시간**: 사용자가 대기실 정보를 파악하는 데 걸리는 평균 시간이 10초 이하

### 기술적 품질
- **대기실 생성 API 성공률**: 대기실 생성 API 호출 성공률이 95% 이상
- **대기실 조회 API 성공률**: 대기실 조회 API 호출 성공률이 95% 이상
- **대기실 설정값 조회 API 성공률**: 대기실 설정값 조회 API 호출 성공률이 95% 이상
- **대기실 페이지 로드 성능**: 대기실 페이지 로드 시간이 2초 이하인 비율이 95% 이상
- **오류 처리 정확도**: 오류 발생 시 적절한 메시지 표시 비율이 100%

### 비즈니스 지표
- **대기실 진입 전환율**: 결제 완료 후 대기실로 이동하는 비율이 95% 이상
- **사용자 이탈률**: 대기실 진입 후 이탈하는 비율이 10% 이하
- **대기실 정보 확인 만족도**: 사용자가 대기실 정보 확인 과정에 만족하는 비율이 80% 이상

---

## 🔗 기술 의존성

### 필수 의존성
- **인증 토큰**: 모든 API 요청 헤더에 `Authorization: Bearer {token}` 형식으로 인증 토큰이 포함되어야 함
- **환경 변수**: 개발 환경에서 사용할 인증 토큰은 `.env.local` 파일의 `NEXT_PUBLIC_DEV_TOKEN` 환경 변수로 관리됨
- **대기실 생성 API**: 타임캡슐 대기실 생성을 위한 API 엔드포인트 (`POST /api/capsules/step-rooms/create`)
- **대기실 설정 조회 API**: 대기실 설정값을 조회하기 위한 API 엔드포인트 (`GET /api/capsules/step-rooms/{capsuleId}/settings`)
- **대기실 상세 조회 API**: 대기실 상세 정보를 조회하기 위한 API 엔드포인트 (`GET /api/capsules/step-rooms/{capsuleId}`)

### 선택적 의존성
- **로딩 상태 관리**: 대기실 정보 조회 중 상태 표시를 위한 상태 관리
- **오류 처리**: 오류 발생 시 사용자에게 안내하기 위한 오류 처리 메커니즘
- **재시도 로직**: 일시적 오류 발생 시 재시도를 위한 로직

---

## 📝 가정사항

### 사용자 환경
- 사용자는 모바일 기기에서 웹 애플리케이션을 주로 사용함
- 사용자는 터치 인터페이스에 익숙함
- 사용자는 캡슐 설정 페이지에서 타임캡슐 정보를 입력한 경험이 있음

### 기술 환경
- 인증된 사용자만 대기실 페이지에 접근할 수 있음
- 개발 환경에서 사용할 인증 토큰은 `.env.local` 파일의 `NEXT_PUBLIC_DEV_TOKEN` 환경 변수로 선언되어 있음
- 모든 API 요청 시 인증 토큰이 필요함
- 결제 완료 후 대기실 생성은 결제 콜백 기능에서 처리됨

### 비즈니스 규칙
- 결제 완료 후에만 타임캡슐 대기실을 생성할 수 있음
- 대기실은 하나의 주문에 대해 하나만 생성됨
- 대기실 생성 시 캡슐 설정에서 설정한 정보가 대기실에 저장됨
- 방장은 대기실 생성 시 자동으로 참여자로 추가됨
- 대기실 설정값은 캡슐 설정 페이지에서 입력한 정보를 기반으로 조회됨

### 데이터 전달
- 결제 완료 후 대기실 생성 시 주문 ID와 결제 정보가 전달됨
- 대기실 생성 성공 시 대기실 ID가 반환됨
- 대기실 설정값 조회 시 캡슐 설정에서 설정한 정보가 반환됨
- 대기실 상세 조회 시 대기실 ID가 필요함

---

## 🚧 향후 확장 가능성

### 향후 개선 사항
- 초대 코드 생성 및 공유 기능
- 초대 코드를 통한 참여자 대기실 조회
- 참여자의 대기실 참여(슬롯 배정) 및 진입
- 대기실 내 채팅 기능
- 대기실 설정 변경 기능 (캡슐명, 오픈 예정일 등)
- 대기실 나가기 기능
- 대기실 삭제 기능
- 참여자 추방 기능
- 대기실 알림 기능 (새로운 참여자 추가 시)
- 초대 코드 만료 시간 설정
- 대기실 공개/비공개 설정

### 확장 가능한 기능
- 대기실 초대 링크 생성 (초대 코드 대신)
- 소셜 미디어 공유 기능 (초대 코드 공유)
- 대기실 참여자 프로필 표시
- 대기실 참여자 상태 표시 (온라인/오프라인)
- 대기실 히스토리 조회
