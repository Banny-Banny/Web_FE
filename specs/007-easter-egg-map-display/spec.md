# 기능 명세서: 카카오 지도 이스터에그 표시 및 조회

## 개요

사용자가 카카오 지도에서 이스터에그(캡슐)의 위치를 확인하고, 마커를 클릭하여 이스터에그 정보를 조회할 수 있는 기능입니다. 사용자의 현재 위치와 이스터에그 간의 거리, 그리고 이스터에그의 소유자에 따라 서로 다른 모달 UI가 표시됩니다.

### 배경

현재 홈 화면에 카카오 지도가 표시되고 있으나, 지도 위에 이스터에그 마커가 표시되지 않습니다. 사용자가 지도에서 이스터에그의 위치를 확인하고, 마커를 클릭하여 이스터에그의 내용을 확인할 수 있는 기능이 필요합니다.

### 목적

- 사용자가 지도에서 이스터에그의 위치를 시각적으로 확인
- 지도 진입 및 이동 시 자동으로 이스터에그 발견 감지
- 마커 클릭을 통해 이스터에그 정보 조회
- 거리와 소유자 조건에 따라 적절한 UI 제공
- 이스터에그 발견 기록 및 발견자 정보 확인

## 기능 요구사항

### FR-1: 지도에 캡슐 마커 표시

**설명**: 카카오 지도에 주변 캡슐(이스터에그/타임캡슐)의 위치를 마커로 표시합니다.

**수락 기준**:
- 지도가 최초 로드될 때 현재 위치 기준 반경 300m 이내의 캡슐 목록을 조회하여 마커를 표시함
- 지도 이동 또는 확대/축소 시에는 목록을 재조회하지 않음 (최초 로드 시에만 조회)
- 마커는 캡슐의 실제 위치(위도, 경도)에 정확하게 표시됨
- 캡슐 타입(EASTER_EGG, TIME_CAPSULE)에 따라 서로 다른 마커 아이콘으로 표시함
- 내가 숨긴 캡슐과 친구가 숨긴 캡슐을 구분하여 표시할 수 있음 (선택사항)
- 마커 클릭 시 해당 캡슐 정보 조회 화면으로 이동함

### FR-2: 마커 클릭 시 이스터에그 기본 정보 조회

**설명**: 사용자가 마커를 클릭하면 해당 이스터에그의 기본 정보를 조회하여 소유자와 접근 가능 여부를 판단합니다.

**수락 기준**:
- 마커 클릭 시 즉시 이스터에그 기본 정보를 조회함
- 조회 중에는 로딩 상태를 표시함
- 조회 실패 시 사용자에게 적절한 오류 메시지를 표시함
- 조회 성공 시 소유자 정보(내 캡슐/친구 캡슐)를 확인할 수 있음

### FR-3: 내 이스터에그 조회 UI 표시

**설명**: 사용자가 자신이 숨긴 이스터에그를 클릭한 경우, 내 이스터에그 전용 UI를 표시합니다.

**수락 기준**:
- 소유자가 본인인 경우 내 이스터에그 UI가 표시됨
- 내 이스터에그 UI에는 이스터에그 상태 정보가 표시됨
- 발견자 목록을 조회하여 표시함
- 발견자 수, 콘텐츠 미리보기 등 부가 정보를 확인할 수 있음 (해당 정보가 있는 경우)
- 내 이스터에그 UI를 닫을 수 있음

### FR-4: 친구 이스터에그 - 발견 성공 모달 표시 (30m 이내)

**설명**: 사용자가 지도에 진입하거나 이동할 때, 친구가 숨긴 이스터에그가 현재 위치 기준 30m 이내에 있으면 자동으로 발견 성공 모달을 표시하고 콘텐츠를 확인할 수 있습니다.

**수락 기준**:
- 지도 진입 시 현재 위치 기준 30m 이내의 친구 이스터에그가 있으면 자동으로 발견 성공 모달이 표시됨
- 사용자가 지도를 이동하면서 30m 이내로 진입한 친구 이스터에그가 있으면 자동으로 발견 성공 모달이 표시됨
- 친구 캡슐이고 현재 위치 기준 30m 이내인 경우 발견 성공 모달이 표시됨
- 상세 모달 진입 시점에 발견 기록이 자동으로 서버에 저장됨 (사용자에게 별도 안내 없이 백그라운드 처리)
- 이스터에그 상세 정보(제목, 텍스트, 이미지, 음원, 영상 등)를 조회하여 표시함
- 콘텐츠 타입에 따라 적절한 UI가 표시됨:
  - 텍스트 + 이미지
  - 텍스트 + 이미지 + 음원 + 영상
  - 텍스트 + 음원
- 발견 성공 모달을 닫을 수 있음
- 여러 개의 이스터에그가 동시에 30m 이내에 있는 경우, 우선순위에 따라 하나씩 순차적으로 표시하거나 가장 가까운 것을 표시함

### FR-5: 친구 이스터에그 - 힌트 모달 표시 (30m 밖)

**설명**: 친구가 숨긴 이스터에그를 클릭했을 때, 현재 위치 기준 30m 밖에 있으면 힌트 모달을 표시합니다.

**수락 기준**:
- 친구 캡슐이고 현재 위치 기준 30m 밖인 경우 힌트 모달이 표시됨
- 힌트 모달에는 위치 힌트 정보가 표시됨
- 실제 콘텐츠는 표시되지 않음
- 힌트 모달을 닫을 수 있음

### FR-6: 이스터에그 발견 기록

**설명**: 사용자가 친구의 이스터에그를 발견했을 때(30m 이내 진입 및 상세 모달 진입), 서버에 발견 기록을 저장합니다.

**수락 기준**:
- 친구 캡슐이고 현재 위치 기준 30m 이내인 경우, 상세 모달 진입 시점에 발견 기록이 자동으로 서버에 저장됨
- 발견 기록 저장 실패 시에도 사용자 경험에 영향을 주지 않음 (백그라운드 처리)
- 중복 발견 기록이 저장되지 않음

### FR-7: 이스터에그 발견자 목록 조회

**설명**: 이스터에그를 발견한 사용자 목록을 조회하여 표시합니다.

**수락 기준**:
- 내 이스터에그 UI에서 발견자 목록을 조회하여 표시함
- 친구 이스터에그 발견 성공 모달에서도 발견자 목록을 조회할 수 있음 (선택사항)
- 발견자 목록에는 발견한 사용자 정보가 표시됨
- 발견자 목록 조회 실패 시 적절한 오류 처리가 수행됨

### FR-8: 실시간 위치 추적 및 자동 발견 감지

**설명**: 사용자가 지도에 진입하거나 이동할 때 실시간으로 위치를 추적하고, 주변 이스터에그와의 거리를 계산하여 자동으로 발견 가능한 이스터에그를 감지합니다.

**수락 기준**:
- 지도가 로드되면 실시간 위치 추적을 시작함
- 사용자가 지도를 이동할 때마다 현재 위치를 업데이트함
- 주변 이스터에그와의 거리를 실시간으로 계산함
- 친구 이스터에그가 30m 이내로 진입하면 자동으로 발견 성공 모달을 표시함
- 위치 추적 주기가 적절하여 배터리 소모를 최소화함
- 위치 추적이 실패하거나 중단되어도 지도 사용에 영향을 주지 않음

### FR-9: 거리 계산 및 조건 판단

**설명**: 사용자의 현재 위치와 이스터에그 위치 간의 거리를 계산하여 UI 분기 조건을 판단합니다.

**수락 기준**:
- 사용자의 현재 위치를 정확하게 파악함
- 이스터에그 위치와의 거리를 정확하게 계산함
- 일부 이스터에그는 거리 계산이 필요 없을 수 있음 (거리 계산 불필요 플래그가 있는 경우)
- 거리 계산이 필요한 이스터에그에 대해서만 거리 기준으로 판단함
- 30m 기준으로 상세 모달 표시 여부를 정확하게 판단함
- 300m 기준으로 마커 표시 범위를 정확하게 판단함
- 위치 정보가 없는 경우 적절한 처리(기본값 또는 오류 메시지)를 수행함

## 사용자 시나리오

### 시나리오 1: 지도 진입 시 자동 발견 성공

1. 사용자가 홈 화면에 접근하여 카카오 지도를 확인함
2. 지도에 주변 캡슐(이스터에그/타임캡슐) 마커가 타입별로 구분되어 표시됨
3. 시스템이 현재 위치를 파악하고 주변 캡슐과의 거리를 자동으로 계산함
4. 친구 이스터에그 중 현재 위치 기준 30m 이내인 것이 있으면 자동으로 발견 성공 모달이 표시됨
5. 시스템이 캡슐 상세 정보를 조회하여 표시함
6. 사용자가 콘텐츠를 확인함
7. 사용자가 모달을 닫고 지도로 돌아감

### 시나리오 1-1: 지도 이동 중 자동 발견 성공

1. 사용자가 지도를 이동하면서 다른 위치로 이동함
2. 시스템이 실시간으로 현재 위치를 추적하고 주변 캡슐과의 거리를 계산함
3. 이동 중 30m 이내로 진입한 친구 이스터에그가 있으면 자동으로 발견 성공 모달이 표시됨
4. 시스템이 캡슐 상세 정보를 조회하여 표시함
5. 사용자가 콘텐츠를 확인함
6. 사용자가 모달을 닫고 지도로 돌아감

### 시나리오 1-2: 마커 클릭을 통한 캡슐 조회

1. 사용자가 지도에서 특정 마커(이스터에그 또는 타임캡슐)를 클릭함
2. 시스템이 해당 캡슐의 기본 정보를 조회함
3. 캡슐 타입, 소유자, 거리 조건에 따라 적절한 모달이 표시됨
4. 사용자가 모달에서 캡슐 정보를 확인함
5. 사용자가 모달을 닫고 지도로 돌아감

### 시나리오 2: 내 캡슐 조회

1. 사용자가 지도에서 자신이 숨긴 캡슐(이스터에그 또는 타임캡슐) 마커를 클릭함
2. 시스템이 캡슐 기본 정보를 조회하여 소유자를 확인함
3. 내 캡슐 UI가 표시됨 (이스터에그인 경우)
4. 시스템이 발견자 목록을 조회하여 표시함 (이스터에그인 경우)
5. 사용자가 발견자 목록, 발견자 수, 상태 등 정보를 확인함
6. 사용자가 UI를 닫고 지도로 돌아감

### 시나리오 3: 친구 이스터에그 발견 성공 (30m 이내)

1. 사용자가 지도에 진입하거나 이동하면서 친구가 숨긴 이스터에그가 30m 이내에 있게 됨
2. 시스템이 실시간으로 거리를 계산하여 30m 이내임을 감지함
3. 친구 캡슐이고 현재 위치 기준 30m 이내임을 확인함
4. 발견 성공 모달이 자동으로 표시됨
5. 상세 모달 진입 시점에 시스템이 발견 기록을 서버에 저장함 (백그라운드)
6. 시스템이 이스터에그 상세 정보를 조회함
7. 콘텐츠 타입에 맞는 UI로 상세 정보가 표시됨 (제목, 텍스트, 이미지, 음원, 영상 등)
8. 사용자가 콘텐츠를 확인함
9. 사용자가 모달을 닫고 지도로 돌아감

### 시나리오 4: 친구 이스터에그 힌트 확인 (30m 밖)

1. 사용자가 지도에서 친구가 숨긴 이스터에그 마커를 클릭함
2. 시스템이 이스터에그 기본 정보를 조회하여 소유자와 거리를 확인함
3. 친구 캡슐이고 현재 위치 기준 30m 밖임을 확인함
4. 힌트 모달이 표시됨
5. 사용자가 위치 힌트를 확인함
6. 실제 콘텐츠는 표시되지 않음
7. 사용자가 모달을 닫고 지도로 돌아감

### 시나리오 5: 캡슐 목록 조회 실패

1. 사용자가 홈 화면에 접근하여 카카오 지도를 확인함
2. 시스템이 주변 캡슐 목록을 조회하려고 시도함
3. 네트워크 오류 또는 서버 오류로 인해 조회가 실패함
4. 사용자에게 적절한 오류 메시지가 표시됨
5. 재시도 옵션이 제공됨 (선택사항)
6. 사용자가 재시도하거나 지도를 계속 사용할 수 있음

### 시나리오 6: 마커 클릭 시 정보 조회 실패

1. 사용자가 지도에서 캡슐 마커를 클릭함
2. 시스템이 캡슐 기본 정보를 조회하려고 시도함
3. 네트워크 오류 또는 서버 오류로 인해 조회가 실패함
4. 사용자에게 적절한 오류 메시지가 표시됨
5. 모달이 닫히고 지도로 돌아감
6. 사용자가 다시 시도할 수 있음

## 성공 기준

### SC-1: 기능 완성도

- 지도에 캡슐 마커 표시 성공률이 95% 이상
- 캡슐 타입별 마커 구분이 정확하게 표시됨
- 마커 클릭 시 정보 조회 성공률이 95% 이상
- 실시간 위치 추적 성공률이 90% 이상
- 자동 발견 감지 정확도가 95% 이상 (30m 이내 진입 시 모달 표시)
- 거리 계산 정확도가 100% (30m 기준 오차 ±5m 이내, 300m 기준 오차 ±10m 이내)
- 소유자 판단 정확도가 100%
- UI 분기 정확도가 100% (조건에 맞는 UI가 표시됨)
- 발견 기록 저장 성공률이 90% 이상

### SC-2: 사용자 경험 품질

- 지도 진입 시 자동 발견 모달 표시까지 소요 시간이 3초 이내
- 지도 이동 중 자동 발견 감지 지연 시간이 1초 이내
- 마커 클릭 후 모달 표시까지 소요 시간이 2초 이내
- 이스터에그 목록 조회 완료 시간이 3초 이내
- 상세 정보 조회 완료 시간이 2초 이내
- 사용자가 마커를 쉽게 식별하고 클릭할 수 있음
- 모달 UI가 직관적이고 사용하기 쉬움
- 자동 발견 모달이 사용자의 지도 사용을 방해하지 않음
- 오류 발생 시 사용자가 다음 행동을 취할 수 있도록 명확한 안내가 제공됨

### SC-3: 데이터 정확성

- 마커 위치가 이스터에그의 실제 위치와 일치함
- 거리 계산이 정확함
- 소유자 정보가 정확함
- 상세 정보가 서버 데이터와 일치함
- 발견 기록이 정확하게 저장됨

### SC-4: 오류 처리 완성도

- 모든 예상 가능한 오류 상황에 대한 처리가 구현됨
- 사용자가 오류 원인을 이해할 수 있는 메시지 제공
- 오류 발생 시 사용자가 취할 수 있는 조치가 명확히 안내됨
- 오류 후에도 사용자가 지도를 계속 사용할 수 있음

## 핵심 엔티티

### 캡슐 목록 항목

**설명**: 지도에 표시할 캡슐(이스터에그/타임캡슐)의 기본 정보

**속성**:
- `id` (string, 필수): 캡슐 고유 식별자
- `latitude` (number, 필수): 위도
- `longitude` (number, 필수): 경도
- `distance_m` (number, 선택): 사용자와의 거리(m)
- `type` (string, 필수): 캡슐 타입 ("EASTER_EGG" | "TIME_CAPSULE")
- `is_mine` (boolean, 필수): 내 캡슐 여부
- `can_open` (boolean, 필수): 열 수 있는지 여부
- `title` (string, 선택): 제목
- `view_limit` (number, 선택): 조회 제한 수
- `view_count` (number, 선택): 현재 조회 수
- `media_types` (string[], 선택): 미디어 타입 배열
- `media_urls` (string[], 선택): 미디어 URL 배열

### 이스터에그 기본 정보

**설명**: 마커 클릭 시 조회하는 이스터에그의 기본 상태 정보

**속성**:
- `capsuleId` (string, 필수): 이스터에그 고유 식별자
- `ownerId` (string, 필수): 소유자 식별자
- `isOwnCapsule` (boolean, 필수): 내 캡슐 여부
- `isAccessible` (boolean, 필수): 접근 가능 여부
- `location` (object, 필수): 위치 정보 (위도, 경도)

### 이스터에그 상세 정보

**설명**: 발견 성공 시 표시할 이스터에그의 실제 콘텐츠

**속성**:
- `title` (string, 선택): 제목
- `text` (string, 선택): 텍스트 내용
- `image` (string, 선택): 이미지 URL
- `audio` (string, 선택): 음원 URL
- `video` (string, 선택): 영상 URL
- `contentType` (string, 필수): 콘텐츠 타입 조합 (예: "text-image", "text-image-audio-video", "text-audio")

### 발견 기록

**설명**: 사용자가 이스터에그를 발견했음을 기록하는 데이터

**속성**:
- `capsuleId` (string, 필수): 이스터에그 고유 식별자
- `userId` (string, 필수): 발견한 사용자 식별자
- `discoveredAt` (datetime, 필수): 발견 시각

### 발견자 정보

**설명**: 이스터에그를 발견한 사용자 정보

**속성**:
- `userId` (string, 필수): 사용자 식별자
- `userName` (string, 선택): 사용자 이름
- `discoveredAt` (datetime, 필수): 발견 시각

## 비기능 요구사항

### NFR-1: 성능

- 캡슐 목록 조회 응답 시간이 3초 이내
- 마커 클릭 후 기본 정보 조회 응답 시간이 2초 이내
- 상세 정보 조회 응답 시간이 2초 이내
- 거리 계산 수행 시간이 100ms 이내
- 실시간 위치 추적 및 거리 계산이 지도 성능에 미치는 영향이 최소화됨
- 위치 추적 주기가 적절하여 배터리 소모를 최소화함
- 마커 렌더링이 지도 성능에 미치는 영향이 최소화됨

### NFR-2: 안정성

- 네트워크 오류 시 적절한 오류 처리 및 사용자 안내
- 서버 오류 시 사용자가 지도를 계속 사용할 수 있음
- 발견 기록 저장 실패 시에도 사용자 경험에 영향을 주지 않음
- 타임아웃 상황에 대한 적절한 처리

### NFR-3: 보안

- 모든 API 요청에 인증 토큰이 포함됨
- 사용자 위치 정보가 안전하게 전송됨
- 이스터에그 접근 권한이 정확하게 검증됨

### NFR-4: 접근성

- 마커가 스크린 리더를 통해 접근 가능함
- 모달이 키보드만으로 조작 가능함
- 오류 메시지가 스크린 리더를 통해 읽을 수 있음

## 제약사항

### 기술적 제약사항

- 카카오 지도 API를 사용하여 지도 및 마커를 표시함
- 캡슐 목록 조회 API는 `GET /api/capsules`를 사용함
- 캡슐 목록 조회는 최초 지도 로드 시에만 수행되며, 현재 위치 기준 반경 300m 이내의 캡슐만 조회함
- 캡슐 타입(EASTER_EGG, TIME_CAPSULE)에 따라 서로 다른 마커 아이콘을 사용함
- 캡슐 기본 정보 조회 API는 `GET /api/capsules/{id}`를 사용함
- 캡슐 상세 정보 조회 API는 `GET /api/capsules/{id}/detail`을 사용함
- 발견 기록 API는 `POST /api/capsules/{id}/viewers`를 사용함
- 발견자 목록 조회 API는 `GET /api/capsules/{id}/viewers`를 사용함
- 거리 계산은 사용자의 현재 위치와 캡슐 위치 간의 직선 거리를 기준으로 함
- 마커 표시 범위는 300m를 기준으로 함
- 상세 모달 표시 기준은 30m를 기준으로 함

### 비즈니스 제약사항

- 친구 이스터에그는 30m 이내에 있어야 콘텐츠를 확인할 수 있음
- 친구 이스터에그가 30m 밖에 있으면 힌트만 표시됨
- 내 이스터에그는 거리 제한 없이 항상 확인 가능함
- 발견 기록은 한 사용자가 동일 이스터에그에 대해 한 번만 저장됨
- 마커는 현재 위치 기준 반경 300m 이내의 이스터에그만 표시됨

### 사용자 경험 제약사항

- 위치 정보가 없으면 거리 계산이 불가능하여 기본값 또는 오류 처리가 필요함
- 마커가 너무 많을 경우 성능 저하를 방지하기 위한 최적화가 필요함 (선택사항)

## 가정사항

### 기술 가정

- 사용자의 브라우저가 Geolocation API를 지원함
- 사용자가 위치 권한을 허용할 수 있음
- 네트워크 연결이 일반적으로 안정적임
- API 서버가 정상적으로 동작함
- 카카오 지도 API가 정상적으로 동작함

### 사용자 가정

- 사용자가 위치 권한 허용에 동의함
- 사용자가 지도에서 마커를 클릭하는 방법을 이해함
- 사용자가 모달 UI를 닫는 방법을 이해함

### 비즈니스 가정

- 이스터에그의 위치 정보가 정확함
- 소유자 정보가 정확함
- 30m 거리 기준이 사용자에게 적절함 (상세 모달 표시)
- 300m 거리 기준이 사용자에게 적절함 (마커 표시 범위)

## 엣지 케이스

### EC-1: 위치 정보 수집 실패

**상황**: 사용자의 현재 위치를 수집할 수 없는 경우

**처리**:
- 기본값(예: 마지막으로 알려진 위치)을 사용하거나
- 거리 계산을 건너뛰고 기본 UI를 표시하거나
- 사용자에게 위치 권한 설정을 확인하도록 안내함

### EC-2: 캡슐 목록이 매우 많은 경우

**상황**: 현재 위치 기준 반경 300m 이내에 수백 개의 캡슐이 있는 경우

**처리**:
- 마커 클러스터링을 적용하거나 (선택사항)
- 성능 최적화를 통해 렌더링 속도를 유지함
- 최초 로드 시에만 조회하므로 지도 이동 시 성능 부담이 없음
- 페이지네이션을 활용하여 필요한 만큼만 로드함

### EC-3: 동시에 여러 마커 클릭

**상황**: 사용자가 빠르게 여러 마커를 연속으로 클릭하는 경우

**처리**:
- 첫 번째 클릭만 처리하고 나머지는 무시함
- 또는 마지막 클릭만 처리함
- 중복 요청을 방지하는 메커니즘 적용

### EC-4: 발견 기록 저장 실패

**상황**: 발견 기록을 서버에 저장하는 데 실패한 경우

**처리**:
- 사용자 경험에 영향을 주지 않도록 백그라운드에서 처리함
- 재시도 메커니즘을 적용할 수 있음 (선택사항)
- 사용자에게 별도 안내 없이 계속 진행함

### EC-5: 상세 정보 조회 실패

**상황**: 발견 성공 모달에서 상세 정보를 조회하는 데 실패한 경우

**처리**:
- 사용자에게 적절한 오류 메시지를 표시함
- 모달을 닫을 수 있도록 함
- 재시도 옵션을 제공할 수 있음 (선택사항)

### EC-6: 거리 계산 중 위치 변경

**상황**: 거리 계산 중에 사용자의 위치가 변경되는 경우

**처리**:
- 실시간 위치 추적을 통해 최신 위치를 기준으로 지속적으로 거리를 재계산함
- 자동 발견 모달 표시 시에는 최신 위치를 기준으로 판단함

### EC-7: 거리 계산이 불필요한 이스터에그

**상황**: 일부 이스터에그는 거리 계산이 필요 없이 바로 접근 가능한 경우

**처리**:
- 거리 계산 불필요 플래그가 있는 이스터에그는 거리 계산을 건너뜀
- 해당 이스터에그는 거리 조건 없이 바로 접근 가능함
- 마커 클릭 시 또는 자동 발견 시 거리 계산 없이 바로 상세 모달을 표시함

### EC-8: 여러 캡슐 동시 발견

**상황**: 지도 진입 시 또는 이동 중 여러 개의 친구 이스터에그가 동시에 30m 이내에 있는 경우

**처리**:
- 우선순위에 따라 하나씩 순차적으로 모달을 표시함
- 또는 가장 가까운 캡슐을 먼저 표시함
- 사용자가 첫 번째 모달을 닫으면 다음 모달이 자동으로 표시됨

## 참고사항

### API 스펙

#### 캡슐 목록 조회 API

**엔드포인트**: `GET /api/capsules`

**설명**: 캡슐(이스터에그/타임캡슐) 위치 기반 목록 조회. lat/lng 필수. radius_m(기본 300m), 친구/반경/소진 필터로 접근 가능한 캡슐 목록을 반환합니다. type 필드로 EASTER_EGG와 TIME_CAPSULE을 구분합니다.

**필수 파라미터**:
- `lat` (number): 사용자 현재 위도
- `lng` (number): 사용자 현재 경도

**선택 파라미터**:
- `radius_m` (number): 조회 반경(m). 기본 300, 최소 10, 최대 5000
- `limit` (number): 페이지 크기. 기본 50, 최대 200
- `cursor` (string): 다음 페이지 커서 (base64)
- `include_consumed` (boolean): view_limit 소진 캡슐도 can_open=false로 포함 (기본 false)
- `include_locationless` (boolean): 좌표 없는 캡슐도 포함 여부 (기본 false)

**응답 형식** (200 성공):
```json
{
  "items": [
    {
      "id": "string",
      "title": "string",
      "content": "string?",
      "open_at": "datetime",
      "is_locked": "boolean",
      "view_limit": "number",
      "view_count": "number",
      "can_open": "boolean",
      "latitude": "number",
      "longitude": "number",
      "distance_m": "number?",
      "type": "EASTER_EGG" | "TIME_CAPSULE",
      "is_mine": "boolean",
      "media_types": "string[]",
      "media_urls": "string[]",
      "media_items": "object[]",
      "product": "object?"
    }
  ],
  "page_info": null
}
```

**에러 응답**:
- `400`: 좌표/반경/limit 검증 실패
- `401`: 인증 실패
- `403`: 시스템 정책 차단

#### 기타 API

- **캡슐 기본 정보 조회**: `GET /api/capsules/{id}`
- **캡슐 상세 정보 조회**: `GET /api/capsules/{id}/detail`
- **캡슐 발견 기록**: `POST /api/capsules/{id}/viewers`
- **캡슐 발견자 목록 조회**: `GET /api/capsules/{id}/viewers`

### 관련 컴포넌트

- `src/components/home/components/map-view/`: 지도 뷰 컴포넌트
- `src/components/home/hooks/useKakaoMap.ts`: 카카오 지도 훅
- `src/components/home/components/easter-egg-bottom-sheet/`: 이스터에그 바텀시트 컴포넌트 (참고용)

### Figma 디자인

이 명세서는 다음 Figma 디자인을 기반으로 합니다:

- **내가 숨긴 이스터에그**: node-id=600-6931, node-id=600-7114
- **친구 이스터에그 발견 모달 (텍스트 + 이미지)**: node-id=599-6755
- **친구 이스터에그 발견 모달 (텍스트 + 이미지 + 음원 + 영상)**: node-id=599-6801
- **친구 이스터에그 발견 모달 (텍스트 + 음원)**: node-id=599-6868
- **친구 이스터에그 힌트 모달**: node-id=291-1176, node-id=291-1301

### 구현 단계 제안

이 명세서는 구현 세부사항을 포함하지 않지만, 다음 단계인 기술 계획 수립 시 다음 단계들을 고려할 것을 권장합니다:

1. **Phase 1**: API 엔드포인트 함수 생성 및 타입 정의
2. **Phase 2**: 지도 마커 표시 로직 구현
3. **Phase 3**: 실시간 위치 추적 로직 구현
4. **Phase 4**: 거리 계산 및 조건 판단 로직 구현
5. **Phase 5**: 자동 발견 감지 및 모달 표시 로직 구현
6. **Phase 6**: 마커 클릭 이벤트 처리 및 정보 조회
7. **Phase 7**: 조건별 모달 UI 구현
8. **Phase 8**: 발견 기록 저장 로직 구현
9. **Phase 9**: 오류 처리 및 최적화

---

**문서 버전**: 1.0.0  
**작성일**: 2026-01-27  
**다음 단계**: `/speckit.plan` 명령어로 기술 계획 수립
