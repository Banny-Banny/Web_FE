# 기능 명세서: 친구 관리

## 개요

사용자가 자신의 친구 목록을 조회하고, 친구를 추가하거나 삭제할 수 있는 기능입니다. 카카오 소셜 로그인을 통해 연동된 카카오톡 친구는 자동으로 목록에 표시되며, 추가로 전화번호나 이메일을 통해 친구를 추가할 수 있습니다.

### 배경

현재 마이페이지의 친구 영역에서 친구 목록을 확인할 수 있으나, 실제 친구 데이터를 조회하거나 관리하는 기능이 구현되지 않았습니다. 사용자가 자신의 친구 목록을 확인하고, 새로운 친구를 추가하거나 더 이상 소식을 공유하고 싶지 않은 친구를 삭제할 수 있는 기능이 필요합니다.

### 목적

- 사용자가 자신의 친구 목록을 확인할 수 있도록 함
- 카카오 소셜 로그인 사용자의 경우 카카오톡 친구 목록을 자동으로 연동
- 전화번호나 이메일을 통해 새로운 친구를 추가할 수 있도록 함
- 친구 목록을 새로고침하여 최신 상태로 동기화
- 더 이상 소식을 공유하고 싶지 않은 친구를 삭제할 수 있도록 함

## 기능 요구사항

### FR-1: 친구 목록 조회

**설명**: 사용자가 자신의 친구 목록을 조회하여 화면에 표시합니다.

**수락 기준**:
- 친구 관리 화면 진입 시 자동으로 친구 목록을 조회하여 표시함
- 친구 목록에는 친구의 닉네임, 프로필 이미지가 표시됨
- 친구 목록이 비어있는 경우 적절한 안내 메시지를 표시함
- 친구 목록 조회 중에는 로딩 상태를 표시함
- 친구 목록 조회 실패 시 사용자에게 오류 메시지를 표시함
- 친구 목록은 페이지네이션을 지원하여 대량의 친구 목록을 효율적으로 표시함
- 전체 친구 수와 현재 표시된 친구 수를 확인할 수 있음

### FR-2: 카카오톡 친구 자동 연동

**설명**: 카카오 소셜 로그인을 사용한 사용자의 경우, 카카오톡 친구 목록이 자동으로 연동되어 친구 목록에 표시됩니다.

**수락 기준**:
- 카카오 소셜 로그인 사용자의 경우 카카오톡 친구 목록이 자동으로 친구 목록에 포함됨
- 카카오톡 친구는 별도의 추가 작업 없이 친구 목록에 표시됨
- 카카오톡 친구와 수동으로 추가한 친구를 구분할 수 있음 (선택사항)
- 카카오 소셜 로그인을 사용하지 않는 사용자의 경우 이 기능은 적용되지 않음

### FR-3: 친구 추가 (전화번호/이메일)

**설명**: 사용자가 전화번호나 이메일을 입력하여 새로운 친구를 추가할 수 있습니다.

**수락 기준**:
- 사용자가 전화번호 또는 이메일을 입력하여 친구를 추가할 수 있음
- 친구 추가 입력 필드와 버튼이 제공됨
- 전화번호 형식이 올바른지 검증함
- 이메일 형식이 올바른지 검증함
- 친구 추가 성공 시 친구 목록에 즉시 반영됨
- 친구 추가 성공 시 사용자에게 성공 메시지를 표시함
- 다음 경우에는 친구 추가가 실패하며 적절한 오류 메시지를 표시함:
  - 자기 자신을 친구로 추가하려고 시도한 경우
  - 해당 전화번호나 이메일의 사용자를 찾을 수 없는 경우
  - 이미 친구 관계이거나 차단된 사용자인 경우
- 친구 추가 중에는 로딩 상태를 표시함

### FR-4: 친구 목록 새로고침

**설명**: 사용자가 새로고침 버튼을 클릭하여 친구 목록을 최신 상태로 동기화합니다.

**수락 기준**:
- 새로고침 버튼을 클릭하면 친구 목록을 서버에서 다시 조회함
- 카카오 소셜 로그인 사용자의 경우 새로고침 시 카카오톡 친구 목록도 함께 동기화됨
- 새로고침 중에는 로딩 상태를 표시함
- 새로고침 완료 후 최신 친구 목록이 화면에 표시됨
- 새로고침 실패 시 사용자에게 오류 메시지를 표시함
- 새로고침 성공 시 사용자에게 성공 메시지를 표시함 (선택사항)

### FR-5: 친구 삭제

**설명**: 사용자가 더 이상 소식을 공유하고 싶지 않은 친구를 목록에서 삭제할 수 있습니다.

**수락 기준**:
- 각 친구 항목에 삭제 버튼이 제공됨
- 삭제 버튼 클릭 시 확인 절차를 거침 (선택사항)
- 친구 삭제 성공 시 해당 친구가 목록에서 즉시 제거됨
- 친구 삭제 성공 시 사용자에게 성공 메시지를 표시함
- 다음 경우에는 친구 삭제가 실패하며 적절한 오류 메시지를 표시함:
  - 해당 친구 관계를 찾을 수 없는 경우
  - 친구 관계를 삭제할 권한이 없는 경우
- 친구 삭제 중에는 로딩 상태를 표시함
- 삭제된 친구는 다시 추가할 수 있음

## 사용자 시나리오

### 시나리오 1: 친구 목록 확인

1. 사용자가 마이페이지에서 친구 영역을 클릭함
2. 친구 관리 화면이 표시됨
3. 시스템이 자동으로 친구 목록을 조회함
4. 친구 목록이 화면에 표시됨
5. 사용자는 자신의 친구 목록을 확인할 수 있음

### 시나리오 2: 카카오톡 친구 자동 연동

1. 카카오 소셜 로그인을 사용한 사용자가 친구 관리 화면에 진입함
2. 시스템이 카카오톡 친구 목록을 자동으로 조회함
3. 카카오톡 친구가 친구 목록에 자동으로 표시됨
4. 사용자는 별도의 추가 작업 없이 카카오톡 친구를 확인할 수 있음

### 시나리오 3: 전화번호로 친구 추가

1. 사용자가 친구 관리 화면에서 친구 추가 입력 필드를 찾음
2. 사용자가 친구의 전화번호를 입력함
3. 사용자가 친구 추가 버튼을 클릭함
4. 시스템이 전화번호를 검증하고 해당 사용자를 찾음
5. 친구 추가가 성공하면 친구 목록에 즉시 반영됨
6. 사용자에게 성공 메시지가 표시됨

### 시나리오 4: 이메일로 친구 추가

1. 사용자가 친구 관리 화면에서 친구 추가 입력 필드를 찾음
2. 사용자가 친구의 이메일을 입력함
3. 사용자가 친구 추가 버튼을 클릭함
4. 시스템이 이메일을 검증하고 해당 사용자를 찾음
5. 친구 추가가 성공하면 친구 목록에 즉시 반영됨
6. 사용자에게 성공 메시지가 표시됨

### 시나리오 5: 친구 목록 새로고침

1. 사용자가 친구 관리 화면에서 새로고침 버튼을 클릭함
2. 시스템이 친구 목록을 서버에서 다시 조회함
3. 카카오 소셜 로그인 사용자의 경우 카카오톡 친구 목록도 함께 동기화됨
4. 최신 친구 목록이 화면에 표시됨
5. 사용자는 최신 상태의 친구 목록을 확인할 수 있음

### 시나리오 6: 친구 삭제

1. 사용자가 친구 관리 화면에서 특정 친구의 삭제 버튼을 클릭함
2. 시스템이 삭제 확인을 요청함 (선택사항)
3. 사용자가 삭제를 확인함
4. 시스템이 친구 관계를 삭제함
5. 해당 친구가 목록에서 제거됨
6. 사용자에게 삭제 완료 메시지가 표시됨

### 시나리오 7: 친구 추가 실패 (사용자를 찾을 수 없음)

1. 사용자가 존재하지 않는 전화번호나 이메일을 입력함
2. 사용자가 친구 추가 버튼을 클릭함
3. 시스템이 해당 전화번호나 이메일의 사용자를 찾을 수 없음을 확인함
4. 사용자에게 "해당 전화번호(또는 이메일)의 사용자를 찾을 수 없습니다"라는 오류 메시지가 표시됨
5. 친구 목록은 변경되지 않음

### 시나리오 8: 친구 추가 실패 (이미 친구 관계)

1. 사용자가 이미 친구인 사용자의 전화번호나 이메일을 입력함
2. 사용자가 친구 추가 버튼을 클릭함
3. 시스템이 이미 친구 관계임을 확인함
4. 사용자에게 "이미 친구 관계입니다"라는 오류 메시지가 표시됨
5. 친구 목록은 변경되지 않음

## 성공 기준

### SC-1: 친구 목록 조회 성능

- 친구 목록 조회 요청이 2초 이내에 완료됨
- 친구 목록이 정확하게 표시됨 (오류율 1% 미만)

### SC-2: 친구 추가 성공률

- 유효한 전화번호나 이메일로 친구 추가 시 95% 이상 성공함
- 친구 추가 실패 시 사용자에게 명확한 오류 메시지가 표시됨

### SC-3: 친구 목록 동기화

- 새로고침 버튼 클릭 시 3초 이내에 최신 친구 목록이 표시됨
- 카카오톡 친구 목록 동기화가 정상적으로 작동함

### SC-4: 친구 삭제 성공률

- 친구 삭제 요청이 2초 이내에 완료됨
- 친구 삭제 성공률이 99% 이상임

### SC-5: 사용자 만족도

- 사용자가 친구 관리 기능을 사용하여 원하는 작업을 완료할 수 있음
- 오류 발생 시 사용자에게 명확한 안내가 제공됨

## 핵심 엔티티

### 친구 관계 (Friendship)

- **id**: 친구 관계 고유 식별자
- **status**: 친구 관계 상태 (예: CONNECTED)
- **friend**: 친구 정보
  - **id**: 친구 사용자 고유 식별자
  - **nickname**: 친구 닉네임
  - **profileImg**: 친구 프로필 이미지 URL
- **createdAt**: 친구 관계 생성 일시

### 친구 목록 응답 (Friends List Response)

- **items**: 친구 목록 배열
- **total**: 전체 친구 수
- **limit**: 한 페이지에 표시할 아이템 수
- **offset**: 건너뛴 아이템 수
- **hasNext**: 다음 페이지 존재 여부

### 친구 추가 요청 (Add Friend Request)

- **phoneNumber**: 친구의 전화번호 (선택사항)
- **email**: 친구의 이메일 (선택사항)

### 친구 추가 응답 (Add Friend Response)

- **message**: 성공 메시지
- **friendshipId**: 생성된 친구 관계 고유 식별자

## 비기능 요구사항

### NFR-1: 성능

- 친구 목록 조회 응답 시간: 2초 이내
- 친구 추가/삭제 응답 시간: 2초 이내
- 새로고침 동기화 시간: 3초 이내

### NFR-2: 보안

- 친구 목록 조회는 인증된 사용자만 가능함
- 친구 추가/삭제는 본인만 가능함
- 전화번호와 이메일 정보는 안전하게 전송됨

### NFR-3: 사용자 경험

- 모든 작업에 적절한 로딩 상태 표시
- 오류 발생 시 사용자 친화적인 메시지 제공
- 친구 목록이 비어있는 경우 적절한 안내 제공

### NFR-4: 접근성

- 키보드로 모든 기능을 사용할 수 있음
- 스크린 리더 사용자를 위한 적절한 라벨 제공

## 제약사항

- 친구 목록은 페이지네이션을 통해 조회되며, 한 번에 최대 20개의 친구를 조회할 수 있음
- 카카오톡 친구 자동 연동은 카카오 소셜 로그인 사용자에게만 적용됨
- 친구 추가는 전화번호 또는 이메일 중 하나만 사용 가능함 (동시 사용 불가)

## 가정사항

- 사용자는 유효한 인증 토큰을 가지고 있음
- 서버는 친구 목록 조회, 추가, 삭제 API를 제공함
- 카카오 소셜 로그인 사용자의 경우 카카오톡 친구 목록 정보가 서버에 저장되어 있음
- 친구 추가 시 친구 관계는 자동으로 승인됨 (별도의 승인 절차 없음)

## 엣지 케이스

### EC-1: 친구 목록이 비어있는 경우

- 친구 목록이 비어있는 경우 "친구가 없습니다" 또는 "친구를 추가해보세요"와 같은 안내 메시지를 표시함

### EC-2: 네트워크 오류

- 네트워크 오류 발생 시 사용자에게 "네트워크 연결을 확인해주세요"라는 메시지를 표시하고 재시도 옵션을 제공함

### EC-3: 동시에 여러 친구 추가 시도

- 사용자가 빠르게 여러 친구를 추가하려고 시도하는 경우, 각 요청이 순차적으로 처리되도록 함

### EC-4: 친구 삭제 후 즉시 다시 추가

- 친구를 삭제한 후 즉시 같은 친구를 다시 추가할 수 있어야 함

### EC-5: 카카오톡 친구 목록 변경

- 사용자가 카카오톡에서 친구를 추가하거나 삭제한 경우, 새로고침을 통해 최신 상태로 동기화할 수 있어야 함
