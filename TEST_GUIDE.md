# 카카오 소셜 로그인 테스트 가이드

## 🧪 테스트 전 확인사항

### 1. 빌드 확인
```bash
npm run build
```

### 2. 타입 체크
```bash
npx tsc --noEmit
```

### 3. 개발 서버 실행
```bash
npm run dev
```

---

## 📋 수동 테스트 체크리스트

### ✅ Phase 1: 기본 기능 테스트

#### 1. 카카오 로그인 버튼 표시 확인
- [ ] `/login` 페이지 접속
- [ ] "카카오로 시작하기" 버튼이 표시되는지 확인
- [ ] 버튼 클릭 가능한지 확인

#### 2. 카카오 로그인 시작 확인
- [ ] "카카오로 시작하기" 버튼 클릭
- [ ] 브라우저가 백엔드 OAuth URL로 리다이렉트되는지 확인
- [ ] URL 형식: `/api/auth/kakao?redirect_uri=http://localhost:3000/auth/callback`

#### 3. 콜백 페이지 테스트 (수동)
**주의**: 실제 카카오 인증이 필요하므로, 백엔드가 테스트 토큰을 제공하는 경우에만 가능합니다.

- [ ] `/auth/callback?token=test_token` 접속
- [ ] "카카오 로그인 처리 중..." 메시지 표시 확인
- [ ] 토큰이 없을 경우 에러 메시지 표시 확인

#### 4. 에러 처리 확인
- [ ] `/auth/callback` (토큰 없음) 접속
- [ ] "인증 토큰이 없습니다." 에러 메시지 표시 확인
- [ ] 2초 후 로그인 페이지로 리다이렉트되는지 확인

---

## 🔍 개발자 도구 확인사항

### Network 탭
1. 브라우저 개발자 도구 열기 (F12)
2. Network 탭 선택
3. "카카오로 시작하기" 버튼 클릭
4. 다음 요청 확인:
   - `GET /api/auth/kakao?redirect_uri=...` 요청 발생
   - 리다이렉트 응답 확인

### Console 탭
1. Console 탭에서 에러 메시지 확인
2. 예상 로그:
   - `카카오 로그인 시작 실패:` (에러 발생 시)
   - `토큰 검증 실패:` (콜백 페이지에서)

### Application 탭 (Local Storage)
1. 콜백 페이지에서 토큰 저장 확인
2. `timeEgg_accessToken` 키에 토큰이 저장되는지 확인

---

## 🧪 Playwright 테스트 (선택사항)

### 기본 테스트 실행
```bash
# 개발 서버가 실행 중이어야 함
npm run dev

# 다른 터미널에서
npm run test
```

### UI 모드로 테스트
```bash
npm run test:ui
```

---

## 🐛 문제 해결

### 문제: 리다이렉트가 동작하지 않음
**확인사항**:
1. `EXTERNAL_ENDPOINTS.KAKAO_LOGIN` 값 확인
2. 브라우저 콘솔에서 에러 메시지 확인
3. `window.location.href`가 올바르게 설정되는지 확인

### 문제: 콜백 페이지에서 토큰을 찾을 수 없음
**확인사항**:
1. URL에 `?token=...` 파라미터가 있는지 확인
2. `useSearchParams()`가 올바르게 동작하는지 확인
3. Next.js App Router의 클라이언트 컴포넌트인지 확인 (`'use client'`)

### 문제: 토큰 검증 실패
**확인사항**:
1. 백엔드 `/api/auth/verify` 엔드포인트가 동작하는지 확인
2. 토큰이 올바르게 저장되었는지 확인 (Local Storage)
3. API 클라이언트가 토큰을 헤더에 포함하는지 확인

---

## 📝 테스트 시나리오

### 시나리오 1: 정상 로그인 플로우
1. `/login` 접속
2. "카카오로 시작하기" 클릭
3. 백엔드 OAuth URL로 리다이렉트
4. 카카오 인증 완료 (백엔드에서 처리)
5. `/auth/callback?token=...`로 리다이렉트
6. 토큰 저장 및 사용자 정보 조회
7. 온보딩 상태에 따라 리다이렉트

### 시나리오 2: 토큰 없음 에러
1. `/auth/callback` 직접 접속 (토큰 없음)
2. 에러 메시지 표시 확인
3. 로그인 페이지로 리다이렉트 확인

### 시나리오 3: 토큰 검증 실패
1. `/auth/callback?token=invalid_token` 접속
2. 토큰 저장 시도
3. 토큰 검증 실패 에러 확인
4. 로그인 페이지로 리다이렉트 확인

---

## ✅ 완료 기준

- [ ] 빌드 성공
- [ ] 타입 체크 통과
- [ ] 카카오 로그인 버튼 클릭 시 리다이렉트 동작
- [ ] 콜백 페이지에서 토큰 추출 동작
- [ ] 에러 처리 동작 확인
- [ ] 브라우저 콘솔에 에러 없음
